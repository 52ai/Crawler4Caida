{"version":3,"file":"texture-3d.js","names":["Texture3D","gl","props","assertWebGL2Context","Object","assign","depth","target","unpackFlipY","initialize","seal","level","dataFormat","width","height","border","format","type","offset","data","parameters","_trackDeallocatedMemory","bindTexture","handle","withParameters","ArrayBuffer","isView","texImage3D","Buffer","bindBuffer","byteLength","_trackAllocatedMemory","channels","DATA_FORMAT_CHANNELS","channelSize","TYPE_SIZES","loaded","isWebGL2","Texture","Symbol","toStringTag"],"sources":["../../../src/classes/texture-3d.js"],"sourcesContent":["import GL from '@luma.gl/constants';\nimport {isWebGL2, assertWebGL2Context, withParameters} from '@luma.gl/gltools';\nimport Texture from './texture';\nimport {DATA_FORMAT_CHANNELS, TYPE_SIZES} from './texture-formats';\nimport Buffer from './buffer';\n\nexport default class Texture3D extends Texture {\n  // eslint-disable-next-line accessor-pairs\n  get [Symbol.toStringTag]() {\n    return 'Texture3D';\n  }\n\n  static isSupported(gl) {\n    return isWebGL2(gl);\n  }\n\n  constructor(gl, props = {}) {\n    assertWebGL2Context(gl);\n    props = Object.assign({depth: 1}, props, {target: GL.TEXTURE_3D, unpackFlipY: false});\n    super(gl, props);\n    this.initialize(props);\n\n    Object.seal(this);\n  }\n\n  // Image 3D copies from Typed Array or WebGLBuffer\n  setImageData({\n    level = 0,\n    dataFormat = GL.RGBA,\n    width,\n    height,\n    depth = 1,\n    border = 0,\n    format,\n    type = GL.UNSIGNED_BYTE,\n    offset = 0,\n    data,\n    parameters = {}\n  }) {\n    this._trackDeallocatedMemory('Texture');\n\n    this.gl.bindTexture(this.target, this.handle);\n\n    withParameters(this.gl, parameters, () => {\n      if (ArrayBuffer.isView(data)) {\n        // @ts-ignore\n        this.gl.texImage3D(\n          this.target,\n          level,\n          dataFormat,\n          width,\n          height,\n          depth,\n          border,\n          format,\n          type,\n          data\n        );\n      }\n\n      if (data instanceof Buffer) {\n        this.gl.bindBuffer(GL.PIXEL_UNPACK_BUFFER, data.handle);\n        // @ts-ignore\n        this.gl.texImage3D(\n          this.target,\n          level,\n          dataFormat,\n          width,\n          height,\n          depth,\n          border,\n          format,\n          type,\n          offset\n        );\n      }\n    });\n\n    if (data && data.byteLength) {\n      this._trackAllocatedMemory(data.byteLength, 'Texture');\n    } else {\n      // NOTE(Tarek): Default to RGBA bytes\n      // @ts-ignore\n      const channels = DATA_FORMAT_CHANNELS[this.dataFormat] || 4;\n      // @ts-ignore\n      const channelSize = TYPE_SIZES[this.type] || 1;\n\n      this._trackAllocatedMemory(\n        this.width * this.height * this.depth * channels * channelSize,\n        'Texture'\n      );\n    }\n\n    this.loaded = true;\n\n    return this;\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;AACA;;AACA;;AACA;;AACA;;;;;;IAEqBA,S;;;;;EAUnB,mBAAYC,EAAZ,EAA4B;IAAA;;IAAA,IAAZC,KAAY,uEAAJ,EAAI;IAAA;IAC1B,IAAAC,4BAAA,EAAoBF,EAApB;IACAC,KAAK,GAAGE,MAAM,CAACC,MAAP,CAAc;MAACC,KAAK,EAAE;IAAR,CAAd,EAA0BJ,KAA1B,EAAiC;MAACK,MAAM,OAAP;MAAwBC,WAAW,EAAE;IAArC,CAAjC,CAAR;IACA,0BAAMP,EAAN,EAAUC,KAAV;;IACA,MAAKO,UAAL,CAAgBP,KAAhB;;IAEAE,MAAM,CAACM,IAAP;IAN0B;EAO3B;;;;SAfD,eAA2B;MACzB,OAAO,WAAP;IACD;;;WAgBD,4BAYG;MAAA;;MAAA,sBAXDC,KAWC;MAAA,IAXDA,KAWC,2BAXO,CAWP;MAAA,2BAVDC,UAUC;MAAA,IAVDA,UAUC;MAAA,IATDC,KASC,QATDA,KASC;MAAA,IARDC,MAQC,QARDA,MAQC;MAAA,sBAPDR,KAOC;MAAA,IAPDA,KAOC,2BAPO,CAOP;MAAA,uBANDS,MAMC;MAAA,IANDA,MAMC,4BANQ,CAMR;MAAA,IALDC,MAKC,QALDA,MAKC;MAAA,qBAJDC,IAIC;MAAA,IAJDA,IAIC;MAAA,uBAHDC,MAGC;MAAA,IAHDA,MAGC,4BAHQ,CAGR;MAAA,IAFDC,IAEC,QAFDA,IAEC;MAAA,2BADDC,UACC;MAAA,IADDA,UACC,gCADY,EACZ;;MACD,KAAKC,uBAAL,CAA6B,SAA7B;;MAEA,KAAKpB,EAAL,CAAQqB,WAAR,CAAoB,KAAKf,MAAzB,EAAiC,KAAKgB,MAAtC;MAEA,IAAAC,uBAAA,EAAe,KAAKvB,EAApB,EAAwBmB,UAAxB,EAAoC,YAAM;QACxC,IAAIK,WAAW,CAACC,MAAZ,CAAmBP,IAAnB,CAAJ,EAA8B;UAE5B,MAAI,CAAClB,EAAL,CAAQ0B,UAAR,CACE,MAAI,CAACpB,MADP,EAEEI,KAFF,EAGEC,UAHF,EAIEC,KAJF,EAKEC,MALF,EAMER,KANF,EAOES,MAPF,EAQEC,MARF,EASEC,IATF,EAUEE,IAVF;QAYD;;QAED,IAAIA,IAAI,YAAYS,eAApB,EAA4B;UAC1B,MAAI,CAAC3B,EAAL,CAAQ4B,UAAR,QAA2CV,IAAI,CAACI,MAAhD;;UAEA,MAAI,CAACtB,EAAL,CAAQ0B,UAAR,CACE,MAAI,CAACpB,MADP,EAEEI,KAFF,EAGEC,UAHF,EAIEC,KAJF,EAKEC,MALF,EAMER,KANF,EAOES,MAPF,EAQEC,MARF,EASEC,IATF,EAUEC,MAVF;QAYD;MACF,CAjCD;;MAmCA,IAAIC,IAAI,IAAIA,IAAI,CAACW,UAAjB,EAA6B;QAC3B,KAAKC,qBAAL,CAA2BZ,IAAI,CAACW,UAAhC,EAA4C,SAA5C;MACD,CAFD,MAEO;QAGL,IAAME,QAAQ,GAAGC,oCAAA,CAAqB,KAAKrB,UAA1B,KAAyC,CAA1D;QAEA,IAAMsB,WAAW,GAAGC,0BAAA,CAAW,KAAKlB,IAAhB,KAAyB,CAA7C;;QAEA,KAAKc,qBAAL,CACE,KAAKlB,KAAL,GAAa,KAAKC,MAAlB,GAA2B,KAAKR,KAAhC,GAAwC0B,QAAxC,GAAmDE,WADrD,EAEE,SAFF;MAID;;MAED,KAAKE,MAAL,GAAc,IAAd;MAEA,OAAO,IAAP;IACD;;;WApFD,qBAAmBnC,EAAnB,EAAuB;MACrB,OAAO,IAAAoC,iBAAA,EAASpC,EAAT,CAAP;IACD;;;EARoCqC,gB,EAEhCC,MAAM,CAACC,W"}