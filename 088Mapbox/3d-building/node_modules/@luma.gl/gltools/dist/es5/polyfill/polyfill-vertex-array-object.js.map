{"version":3,"file":"polyfill-vertex-array-object.js","names":["glErrorShadow","error","msg","globalThis","console","log","synthesizeGLError","err","opt_msg","undefined","wrapGLError","gl","f","getError","apply","parseInt","WebGLVertexArrayObjectOES","ext","isAlive","hasBeenBound","elementArrayBuffer","attribs","Array","maxVertexAttribs","n","length","attrib","VertexAttrib","maxAttrib","enabled","buffer","size","type","normalized","stride","offset","cached","recache","prototype","join","OESVertexArrayObject","self","original","getParameter","enableVertexAttribArray","disableVertexAttribArray","bindBuffer","getVertexAttrib","vertexAttribPointer","pname","VERTEX_ARRAY_BINDING_OES","currentVertexArrayObject","defaultVertexArrayObject","arguments","index","vao","Math","max","target","currentArrayBuffer","indx","instrumentExtension","canvas","addEventListener","reset_","contextWasLost","vertexArrayObjects","ii","bindVertexArrayOES","createVertexArrayOES","arrayObject","push","deleteVertexArrayOES","splice","indexOf","isVertexArrayOES","oldVAO","newVAO","call","currentBinding","oldAttrib","bufferChanged","polyfillVertexArrayObject","createVertexArray","original_getSupportedExtensions","getSupportedExtensions","list","original_getExtension","getExtension","name","__OESVertexArrayObject"],"sources":["../../../src/polyfill/polyfill-vertex-array-object.js"],"sourcesContent":["/*\n** Copyright (c) 2015 The Khronos Group Inc.\n**\n** Permission is hereby granted, free of charge, to any person obtaining a\n** copy of this software and/or associated documentation files (the\n** \"Materials\"), to deal in the Materials without restriction, including\n** without limitation the rights to use, copy, modify, merge, publish,\n** distribute, sublicense, and/or sell copies of the Materials, and to\n** permit persons to whom the Materials are furnished to do so, subject to\n** the following conditions:\n**\n** The above copyright notice and this permission notice shall be included\n** in all copies or substantial portions of the Materials.\n**\n** THE MATERIALS ARE PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n** EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n** MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.\n** IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY\n** CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,\n** TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE\n** MATERIALS OR THE USE OR OTHER DEALINGS IN THE MATERIALS.\n*/\n\n// Modified to use ES6 and polyfill a provided context rather than\n// the global class.\n\n// @ts-nocheck external code\n\nconst glErrorShadow = {};\n\nfunction error(msg) {\n  if (globalThis.console && globalThis.console.error) {\n    globalThis.console.error(msg);\n  }\n}\n\nfunction log(msg) {\n  if (globalThis.console && globalThis.console.log) {\n    globalThis.console.log(msg);\n  }\n}\n\nfunction synthesizeGLError(err, opt_msg) {\n  glErrorShadow[err] = true;\n  if (opt_msg !== undefined) {\n    error(opt_msg);\n  }\n}\n\nfunction wrapGLError(gl) {\n  const f = gl.getError;\n  gl.getError = function getError() {\n    let err;\n    do {\n      err = f.apply(gl);\n      if (err !== gl.NO_ERROR) {\n        glErrorShadow[err] = true;\n      }\n    } while (err !== gl.NO_ERROR);\n\n    for (err in glErrorShadow) {\n      if (glErrorShadow[err]) {\n        delete glErrorShadow[err];\n        return parseInt(err, 10);\n      }\n    }\n\n    return gl.NO_ERROR;\n  };\n}\n\nconst WebGLVertexArrayObjectOES = function WebGLVertexArrayObjectOES(ext) {\n  const gl = ext.gl;\n\n  this.ext = ext;\n  this.isAlive = true;\n  this.hasBeenBound = false;\n\n  this.elementArrayBuffer = null;\n  this.attribs = new Array(ext.maxVertexAttribs);\n  for (let n = 0; n < this.attribs.length; n++) {\n    const attrib = new WebGLVertexArrayObjectOES.VertexAttrib(gl);\n    this.attribs[n] = attrib;\n  }\n\n  this.maxAttrib = 0;\n};\n\nWebGLVertexArrayObjectOES.VertexAttrib = function VertexAttrib(gl) {\n  this.enabled = false;\n  this.buffer = null;\n  this.size = 4;\n  this.type = gl.FLOAT;\n  this.normalized = false;\n  this.stride = 16;\n  this.offset = 0;\n\n  this.cached = '';\n  this.recache();\n};\nWebGLVertexArrayObjectOES.VertexAttrib.prototype.recache = function recache() {\n  this.cached = [this.size, this.type, this.normalized, this.stride, this.offset].join(':');\n};\n\nconst OESVertexArrayObject = function OESVertexArrayObject(gl) {\n  const self = this;\n  this.gl = gl;\n\n  wrapGLError(gl);\n\n  const original = (this.original = {\n    getParameter: gl.getParameter,\n    enableVertexAttribArray: gl.enableVertexAttribArray,\n    disableVertexAttribArray: gl.disableVertexAttribArray,\n    bindBuffer: gl.bindBuffer,\n    getVertexAttrib: gl.getVertexAttrib,\n    vertexAttribPointer: gl.vertexAttribPointer\n  });\n\n  gl.getParameter = function getParameter(pname) {\n    if (pname === self.VERTEX_ARRAY_BINDING_OES) {\n      if (self.currentVertexArrayObject === self.defaultVertexArrayObject) {\n        return null;\n      }\n      return self.currentVertexArrayObject;\n    }\n    return original.getParameter.apply(this, arguments);\n  };\n\n  gl.enableVertexAttribArray = function enableVertexAttribArray(index) {\n    const vao = self.currentVertexArrayObject;\n    vao.maxAttrib = Math.max(vao.maxAttrib, index);\n    const attrib = vao.attribs[index];\n    attrib.enabled = true;\n    return original.enableVertexAttribArray.apply(this, arguments);\n  };\n  gl.disableVertexAttribArray = function disableVertexAttribArray(index) {\n    const vao = self.currentVertexArrayObject;\n    vao.maxAttrib = Math.max(vao.maxAttrib, index);\n    const attrib = vao.attribs[index];\n    attrib.enabled = false;\n    return original.disableVertexAttribArray.apply(this, arguments);\n  };\n\n  gl.bindBuffer = function bindBuffer(target, buffer) {\n    switch (target) {\n      case gl.ARRAY_BUFFER:\n        self.currentArrayBuffer = buffer;\n        break;\n      case gl.ELEMENT_ARRAY_BUFFER:\n        self.currentVertexArrayObject.elementArrayBuffer = buffer;\n        break;\n      default:\n    }\n    return original.bindBuffer.apply(this, arguments);\n  };\n\n  gl.getVertexAttrib = function getVertexAttrib(index, pname) {\n    const vao = self.currentVertexArrayObject;\n    const attrib = vao.attribs[index];\n    switch (pname) {\n      case gl.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:\n        return attrib.buffer;\n      case gl.VERTEX_ATTRIB_ARRAY_ENABLED:\n        return attrib.enabled;\n      case gl.VERTEX_ATTRIB_ARRAY_SIZE:\n        return attrib.size;\n      case gl.VERTEX_ATTRIB_ARRAY_STRIDE:\n        return attrib.stride;\n      case gl.VERTEX_ATTRIB_ARRAY_TYPE:\n        return attrib.type;\n      case gl.VERTEX_ATTRIB_ARRAY_NORMALIZED:\n        return attrib.normalized;\n      default:\n        return original.getVertexAttrib.apply(this, arguments);\n    }\n  };\n\n  gl.vertexAttribPointer = function vertexAttribPointer(\n    indx,\n    size,\n    type,\n    normalized,\n    stride,\n    offset\n  ) {\n    const vao = self.currentVertexArrayObject;\n    vao.maxAttrib = Math.max(vao.maxAttrib, indx);\n    const attrib = vao.attribs[indx];\n    attrib.buffer = self.currentArrayBuffer;\n    attrib.size = size;\n    attrib.type = type;\n    attrib.normalized = normalized;\n    attrib.stride = stride;\n    attrib.offset = offset;\n    attrib.recache();\n    return original.vertexAttribPointer.apply(this, arguments);\n  };\n\n  if (gl.instrumentExtension) {\n    gl.instrumentExtension(this, 'OES_vertex_array_object');\n  }\n\n  // undefined for headless gl\n  if (gl.canvas) {\n    gl.canvas.addEventListener(\n      'webglcontextrestored',\n      () => {\n        log('OESVertexArrayObject emulation library context restored');\n        self.reset_();\n      },\n      true\n    );\n  }\n\n  this.reset_();\n};\n\nOESVertexArrayObject.prototype.VERTEX_ARRAY_BINDING_OES = 0x85b5;\n\nOESVertexArrayObject.prototype.reset_ = function reset_() {\n  const contextWasLost = this.vertexArrayObjects !== undefined;\n  if (contextWasLost) {\n    for (let ii = 0; ii < this.vertexArrayObjects.length; ++ii) {\n      this.vertexArrayObjects.isAlive = false;\n    }\n  }\n  const gl = this.gl;\n  this.maxVertexAttribs = gl.getParameter(gl.MAX_VERTEX_ATTRIBS);\n\n  this.defaultVertexArrayObject = new WebGLVertexArrayObjectOES(this);\n  this.currentVertexArrayObject = null;\n  this.currentArrayBuffer = null;\n  this.vertexArrayObjects = [this.defaultVertexArrayObject];\n\n  this.bindVertexArrayOES(null);\n};\n\nOESVertexArrayObject.prototype.createVertexArrayOES = function createVertexArrayOES() {\n  const arrayObject = new WebGLVertexArrayObjectOES(this);\n  this.vertexArrayObjects.push(arrayObject);\n  return arrayObject;\n};\n\nOESVertexArrayObject.prototype.deleteVertexArrayOES = function deleteVertexArrayOES(arrayObject) {\n  arrayObject.isAlive = false;\n  this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(arrayObject), 1);\n  if (this.currentVertexArrayObject === arrayObject) {\n    this.bindVertexArrayOES(null);\n  }\n};\n\nOESVertexArrayObject.prototype.isVertexArrayOES = function isVertexArrayOES(arrayObject) {\n  if (arrayObject && arrayObject instanceof WebGLVertexArrayObjectOES) {\n    if (arrayObject.hasBeenBound && arrayObject.ext === this) {\n      return true;\n    }\n  }\n  return false;\n};\n\nOESVertexArrayObject.prototype.bindVertexArrayOES = function bindVertexArrayOES(arrayObject) {\n  const gl = this.gl;\n  if (arrayObject && !arrayObject.isAlive) {\n    synthesizeGLError(\n      gl.INVALID_OPERATION,\n      'bindVertexArrayOES: attempt to bind deleted arrayObject'\n    );\n    return;\n  }\n  const original = this.original;\n\n  const oldVAO = this.currentVertexArrayObject;\n  this.currentVertexArrayObject = arrayObject || this.defaultVertexArrayObject;\n  this.currentVertexArrayObject.hasBeenBound = true;\n  const newVAO = this.currentVertexArrayObject;\n\n  if (oldVAO === newVAO) {\n    return;\n  }\n\n  if (!oldVAO || newVAO.elementArrayBuffer !== oldVAO.elementArrayBuffer) {\n    original.bindBuffer.call(gl, gl.ELEMENT_ARRAY_BUFFER, newVAO.elementArrayBuffer);\n  }\n\n  let currentBinding = this.currentArrayBuffer;\n  const maxAttrib = Math.max(oldVAO ? oldVAO.maxAttrib : 0, newVAO.maxAttrib);\n  for (let n = 0; n <= maxAttrib; n++) {\n    const attrib = newVAO.attribs[n];\n    const oldAttrib = oldVAO ? oldVAO.attribs[n] : null;\n\n    if (!oldVAO || attrib.enabled !== oldAttrib.enabled) {\n      if (attrib.enabled) {\n        original.enableVertexAttribArray.call(gl, n);\n      } else {\n        original.disableVertexAttribArray.call(gl, n);\n      }\n    }\n\n    if (attrib.enabled) {\n      let bufferChanged = false;\n      if (!oldVAO || attrib.buffer !== oldAttrib.buffer) {\n        if (currentBinding !== attrib.buffer) {\n          original.bindBuffer.call(gl, gl.ARRAY_BUFFER, attrib.buffer);\n          currentBinding = attrib.buffer;\n        }\n        bufferChanged = true;\n      }\n\n      if (bufferChanged || attrib.cached !== oldAttrib.cached) {\n        original.vertexAttribPointer.call(\n          gl,\n          n,\n          attrib.size,\n          attrib.type,\n          attrib.normalized,\n          attrib.stride,\n          attrib.offset\n        );\n      }\n    }\n  }\n\n  if (this.currentArrayBuffer !== currentBinding) {\n    original.bindBuffer.call(gl, gl.ARRAY_BUFFER, this.currentArrayBuffer);\n  }\n};\n\nexport function polyfillVertexArrayObject(gl) {\n  if (typeof gl.createVertexArray === 'function') {\n    // VAOs directly supported on object (i.e. WebGL 2 context)\n    return;\n  }\n\n  const original_getSupportedExtensions = gl.getSupportedExtensions;\n  gl.getSupportedExtensions = function getSupportedExtensions() {\n    const list = original_getSupportedExtensions.call(this) || [];\n    if (list.indexOf('OES_vertex_array_object') < 0) {\n      list.push('OES_vertex_array_object');\n    }\n    return list;\n  };\n\n  const original_getExtension = gl.getExtension;\n  gl.getExtension = function getExtension(name) {\n    const ext = original_getExtension.call(this, name);\n    if (ext) {\n      return ext;\n    }\n    if (name !== 'OES_vertex_array_object') {\n      return null;\n    }\n\n    if (!gl.__OESVertexArrayObject) {\n      this.__OESVertexArrayObject = new OESVertexArrayObject(this);\n    }\n    return this.__OESVertexArrayObject;\n  };\n}\n"],"mappings":"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"}