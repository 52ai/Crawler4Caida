{"version":3,"file":"group-node.js","names":["Matrix4","log","ScenegraphNode","GroupNode","constructor","props","Array","isArray","children","assert","every","child","add","push","remove","indexOf","splice","removeAll","delete","forEach","traverse","visitor","worldMatrix","modelMatrix","multiplyRight","matrix"],"sources":["../../../src/scenegraph/group-node.js"],"sourcesContent":["import {Matrix4} from '@math.gl/core';\nimport {log} from '@luma.gl/webgl';\nimport ScenegraphNode from './scenegraph-node';\n\nexport default class GroupNode extends ScenegraphNode {\n  constructor(props = {}) {\n    props = Array.isArray(props) ? {children: props} : props;\n    const {children = []} = props;\n    log.assert(\n      children.every(child => child instanceof ScenegraphNode),\n      'every child must an instance of ScenegraphNode'\n    );\n    super(props);\n    this.children = children;\n  }\n\n  // Unpacks arrays and nested arrays of children\n  add(...children) {\n    for (const child of children) {\n      if (Array.isArray(child)) {\n        this.add(...child);\n      } else {\n        this.children.push(child);\n      }\n    }\n    return this;\n  }\n\n  remove(child) {\n    const children = this.children;\n    const indexOf = children.indexOf(child);\n    if (indexOf > -1) {\n      children.splice(indexOf, 1);\n    }\n    return this;\n  }\n\n  removeAll() {\n    this.children = [];\n    return this;\n  }\n\n  delete() {\n    this.children.forEach(child => child.delete());\n    this.removeAll();\n    super.delete();\n  }\n\n  traverse(visitor, {worldMatrix = new Matrix4()} = {}) {\n    const modelMatrix = new Matrix4(worldMatrix).multiplyRight(this.matrix);\n\n    for (const child of this.children) {\n      if (child instanceof GroupNode) {\n        child.traverse(visitor, {worldMatrix: modelMatrix});\n      } else {\n        visitor(child, {worldMatrix: modelMatrix});\n      }\n    }\n  }\n}\n"],"mappings":"AAAA,SAAQA,OAAR,QAAsB,eAAtB;AACA,SAAQC,GAAR,QAAkB,gBAAlB;AACA,OAAOC,cAAP,MAA2B,mBAA3B;AAEA,eAAe,MAAMC,SAAN,SAAwBD,cAAxB,CAAuC;EACpDE,WAAW,GAAa;IAAA,IAAZC,KAAY,uEAAJ,EAAI;IACtBA,KAAK,GAAGC,KAAK,CAACC,OAAN,CAAcF,KAAd,IAAuB;MAACG,QAAQ,EAAEH;IAAX,CAAvB,GAA2CA,KAAnD;IACA,MAAM;MAACG,QAAQ,GAAG;IAAZ,IAAkBH,KAAxB;IACAJ,GAAG,CAACQ,MAAJ,CACED,QAAQ,CAACE,KAAT,CAAeC,KAAK,IAAIA,KAAK,YAAYT,cAAzC,CADF,EAEE,gDAFF;IAIA,MAAMG,KAAN;IACA,KAAKG,QAAL,GAAgBA,QAAhB;EACD;;EAGDI,GAAG,GAAc;IAAA,kCAAVJ,QAAU;MAAVA,QAAU;IAAA;;IACf,KAAK,MAAMG,KAAX,IAAoBH,QAApB,EAA8B;MAC5B,IAAIF,KAAK,CAACC,OAAN,CAAcI,KAAd,CAAJ,EAA0B;QACxB,KAAKC,GAAL,CAAS,GAAGD,KAAZ;MACD,CAFD,MAEO;QACL,KAAKH,QAAL,CAAcK,IAAd,CAAmBF,KAAnB;MACD;IACF;;IACD,OAAO,IAAP;EACD;;EAEDG,MAAM,CAACH,KAAD,EAAQ;IACZ,MAAMH,QAAQ,GAAG,KAAKA,QAAtB;IACA,MAAMO,OAAO,GAAGP,QAAQ,CAACO,OAAT,CAAiBJ,KAAjB,CAAhB;;IACA,IAAII,OAAO,GAAG,CAAC,CAAf,EAAkB;MAChBP,QAAQ,CAACQ,MAAT,CAAgBD,OAAhB,EAAyB,CAAzB;IACD;;IACD,OAAO,IAAP;EACD;;EAEDE,SAAS,GAAG;IACV,KAAKT,QAAL,GAAgB,EAAhB;IACA,OAAO,IAAP;EACD;;EAEDU,MAAM,GAAG;IACP,KAAKV,QAAL,CAAcW,OAAd,CAAsBR,KAAK,IAAIA,KAAK,CAACO,MAAN,EAA/B;IACA,KAAKD,SAAL;IACA,MAAMC,MAAN;EACD;;EAEDE,QAAQ,CAACC,OAAD,EAA8C;IAAA,IAApC;MAACC,WAAW,GAAG,IAAItB,OAAJ;IAAf,CAAoC,uEAAJ,EAAI;IACpD,MAAMuB,WAAW,GAAG,IAAIvB,OAAJ,CAAYsB,WAAZ,EAAyBE,aAAzB,CAAuC,KAAKC,MAA5C,CAApB;;IAEA,KAAK,MAAMd,KAAX,IAAoB,KAAKH,QAAzB,EAAmC;MACjC,IAAIG,KAAK,YAAYR,SAArB,EAAgC;QAC9BQ,KAAK,CAACS,QAAN,CAAeC,OAAf,EAAwB;UAACC,WAAW,EAAEC;QAAd,CAAxB;MACD,CAFD,MAEO;QACLF,OAAO,CAACV,KAAD,EAAQ;UAACW,WAAW,EAAEC;QAAd,CAAR,CAAP;MACD;IACF;EACF;;AAtDmD"}