{"version":3,"sources":["../../../src/lib/decode-quantized-mesh.ts"],"names":["QUANTIZED_MESH_HEADER","Map","Float64Array","BYTES_PER_ELEMENT","Float32Array","decodeZigZag","value","decodeHeader","dataView","position","header","key","bytesCount","getter","getFloat64","getFloat32","call","headerEndPosition","decodeVertexData","elementsPerVertex","vertexCount","getUint32","vertexData","Uint16Array","Uint32Array","bytesPerArrayElement","elementArrayLength","uArrayStartPosition","vArrayStartPosition","heightArrayStartPosition","u","v","height","i","getUint16","vertexDataEndPosition","decodeIndex","buffer","indicesCount","bytesPerIndex","encoded","indices","highest","length","code","decodeTriangleIndices","triangleCount","triangleIndicesCount","triangleIndices","triangleIndicesEndPosition","decodeEdgeIndices","westVertexCount","westIndices","southVertexCount","southIndices","eastVertexCount","eastIndices","northVertexCount","northIndices","edgeIndicesEndPosition","decodeVertexNormalsExtension","extensionDataView","Uint8Array","byteOffset","byteLength","decodeWaterMaskExtension","slice","decodeExtensions","indicesEndPosition","extensions","extensionsEndPosition","extensionId","getUint8","extensionLength","extensionView","DataView","vertexNormals","waterMask","DECODING_STEPS","vertices","edgeIndices","DEFAULT_OPTIONS","maxDecodingStep","decode","data","userOptions","options","Object","assign","view"],"mappings":"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","sourcesContent":["// Copyright (C) 2018-2019 HERE Europe B.V.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\n\nconst QUANTIZED_MESH_HEADER = new Map([\n  ['centerX', Float64Array.BYTES_PER_ELEMENT],\n  ['centerY', Float64Array.BYTES_PER_ELEMENT],\n  ['centerZ', Float64Array.BYTES_PER_ELEMENT],\n\n  ['minHeight', Float32Array.BYTES_PER_ELEMENT],\n  ['maxHeight', Float32Array.BYTES_PER_ELEMENT],\n\n  ['boundingSphereCenterX', Float64Array.BYTES_PER_ELEMENT],\n  ['boundingSphereCenterY', Float64Array.BYTES_PER_ELEMENT],\n  ['boundingSphereCenterZ', Float64Array.BYTES_PER_ELEMENT],\n  ['boundingSphereRadius', Float64Array.BYTES_PER_ELEMENT],\n\n  ['horizonOcclusionPointX', Float64Array.BYTES_PER_ELEMENT],\n  ['horizonOcclusionPointY', Float64Array.BYTES_PER_ELEMENT],\n  ['horizonOcclusionPointZ', Float64Array.BYTES_PER_ELEMENT]\n]);\n\nfunction decodeZigZag(value) {\n  return (value >> 1) ^ -(value & 1);\n}\n\nfunction decodeHeader(dataView) {\n  let position = 0;\n  const header = {};\n\n  for (const [key, bytesCount] of QUANTIZED_MESH_HEADER) {\n    const getter = bytesCount === 8 ? dataView.getFloat64 : dataView.getFloat32;\n\n    header[key] = getter.call(dataView, position, true);\n    position += bytesCount;\n  }\n\n  return {header, headerEndPosition: position};\n}\n\nfunction decodeVertexData(dataView, headerEndPosition) {\n  let position = headerEndPosition;\n  const elementsPerVertex = 3;\n  const vertexCount = dataView.getUint32(position, true);\n  const vertexData = new Uint16Array(vertexCount * elementsPerVertex);\n\n  position += Uint32Array.BYTES_PER_ELEMENT;\n\n  const bytesPerArrayElement = Uint16Array.BYTES_PER_ELEMENT;\n  const elementArrayLength = vertexCount * bytesPerArrayElement;\n  const uArrayStartPosition = position;\n  const vArrayStartPosition = uArrayStartPosition + elementArrayLength;\n  const heightArrayStartPosition = vArrayStartPosition + elementArrayLength;\n\n  let u = 0;\n  let v = 0;\n  let height = 0;\n\n  for (let i = 0; i < vertexCount; i++) {\n    u += decodeZigZag(dataView.getUint16(uArrayStartPosition + bytesPerArrayElement * i, true));\n    v += decodeZigZag(dataView.getUint16(vArrayStartPosition + bytesPerArrayElement * i, true));\n    height += decodeZigZag(\n      dataView.getUint16(heightArrayStartPosition + bytesPerArrayElement * i, true)\n    );\n\n    vertexData[i] = u;\n    vertexData[i + vertexCount] = v;\n    vertexData[i + vertexCount * 2] = height;\n  }\n\n  position += elementArrayLength * 3;\n\n  return {vertexData, vertexDataEndPosition: position};\n}\n\nfunction decodeIndex(buffer, position, indicesCount, bytesPerIndex, encoded = true) {\n  let indices;\n\n  if (bytesPerIndex === 2) {\n    indices = new Uint16Array(buffer, position, indicesCount);\n  } else {\n    indices = new Uint32Array(buffer, position, indicesCount);\n  }\n\n  if (!encoded) {\n    return indices;\n  }\n\n  let highest = 0;\n\n  for (let i = 0; i < indices.length; ++i) {\n    const code = indices[i];\n\n    indices[i] = highest - code;\n\n    if (code === 0) {\n      ++highest;\n    }\n  }\n\n  return indices;\n}\n\nfunction decodeTriangleIndices(dataView, vertexData, vertexDataEndPosition) {\n  let position = vertexDataEndPosition;\n  const elementsPerVertex = 3;\n  const vertexCount = vertexData.length / elementsPerVertex;\n  const bytesPerIndex =\n    vertexCount > 65536 ? Uint32Array.BYTES_PER_ELEMENT : Uint16Array.BYTES_PER_ELEMENT;\n\n  if (position % bytesPerIndex !== 0) {\n    position += bytesPerIndex - (position % bytesPerIndex);\n  }\n\n  const triangleCount = dataView.getUint32(position, true);\n  position += Uint32Array.BYTES_PER_ELEMENT;\n\n  const triangleIndicesCount = triangleCount * 3;\n  const triangleIndices = decodeIndex(\n    dataView.buffer,\n    position,\n    triangleIndicesCount,\n    bytesPerIndex\n  );\n  position += triangleIndicesCount * bytesPerIndex;\n\n  return {\n    triangleIndicesEndPosition: position,\n    triangleIndices\n  };\n}\n\nfunction decodeEdgeIndices(dataView, vertexData, triangleIndicesEndPosition) {\n  let position = triangleIndicesEndPosition;\n  const elementsPerVertex = 3;\n  const vertexCount = vertexData.length / elementsPerVertex;\n  const bytesPerIndex =\n    vertexCount > 65536 ? Uint32Array.BYTES_PER_ELEMENT : Uint16Array.BYTES_PER_ELEMENT;\n\n  const westVertexCount = dataView.getUint32(position, true);\n  position += Uint32Array.BYTES_PER_ELEMENT;\n\n  const westIndices = decodeIndex(dataView.buffer, position, westVertexCount, bytesPerIndex, false);\n  position += westVertexCount * bytesPerIndex;\n\n  const southVertexCount = dataView.getUint32(position, true);\n  position += Uint32Array.BYTES_PER_ELEMENT;\n\n  const southIndices = decodeIndex(\n    dataView.buffer,\n    position,\n    southVertexCount,\n    bytesPerIndex,\n    false\n  );\n  position += southVertexCount * bytesPerIndex;\n\n  const eastVertexCount = dataView.getUint32(position, true);\n  position += Uint32Array.BYTES_PER_ELEMENT;\n\n  const eastIndices = decodeIndex(dataView.buffer, position, eastVertexCount, bytesPerIndex, false);\n  position += eastVertexCount * bytesPerIndex;\n\n  const northVertexCount = dataView.getUint32(position, true);\n  position += Uint32Array.BYTES_PER_ELEMENT;\n\n  const northIndices = decodeIndex(\n    dataView.buffer,\n    position,\n    northVertexCount,\n    bytesPerIndex,\n    false\n  );\n  position += northVertexCount * bytesPerIndex;\n\n  return {\n    edgeIndicesEndPosition: position,\n    westIndices,\n    southIndices,\n    eastIndices,\n    northIndices\n  };\n}\n\nfunction decodeVertexNormalsExtension(extensionDataView) {\n  return new Uint8Array(\n    extensionDataView.buffer,\n    extensionDataView.byteOffset,\n    extensionDataView.byteLength\n  );\n}\n\nfunction decodeWaterMaskExtension(extensionDataView) {\n  return extensionDataView.buffer.slice(\n    extensionDataView.byteOffset,\n    extensionDataView.byteOffset + extensionDataView.byteLength\n  );\n}\n\ntype Extensions = {\n  vertexNormals?: any;\n  waterMask?: any;\n};\n\nfunction decodeExtensions(dataView, indicesEndPosition) {\n  const extensions: Extensions = {};\n\n  if (dataView.byteLength <= indicesEndPosition) {\n    return {extensions, extensionsEndPosition: indicesEndPosition};\n  }\n\n  let position = indicesEndPosition;\n\n  while (position < dataView.byteLength) {\n    const extensionId = dataView.getUint8(position, true);\n    position += Uint8Array.BYTES_PER_ELEMENT;\n\n    const extensionLength = dataView.getUint32(position, true);\n    position += Uint32Array.BYTES_PER_ELEMENT;\n\n    const extensionView = new DataView(dataView.buffer, position, extensionLength);\n\n    switch (extensionId) {\n      case 1: {\n        extensions.vertexNormals = decodeVertexNormalsExtension(extensionView);\n\n        break;\n      }\n      case 2: {\n        extensions.waterMask = decodeWaterMaskExtension(extensionView);\n\n        break;\n      }\n      default: {\n        // console.warn(`Unknown extension with id ${extensionId}`)\n      }\n    }\n\n    position += extensionLength;\n  }\n\n  return {extensions, extensionsEndPosition: position};\n}\n\nexport const DECODING_STEPS = {\n  header: 0,\n  vertices: 1,\n  triangleIndices: 2,\n  edgeIndices: 3,\n  extensions: 4\n};\n\nconst DEFAULT_OPTIONS = {\n  maxDecodingStep: DECODING_STEPS.extensions\n};\n\nexport default function decode(data, userOptions) {\n  const options = Object.assign({}, DEFAULT_OPTIONS, userOptions);\n  const view = new DataView(data);\n  const {header, headerEndPosition} = decodeHeader(view);\n\n  if (options.maxDecodingStep < DECODING_STEPS.vertices) {\n    return {header};\n  }\n\n  const {vertexData, vertexDataEndPosition} = decodeVertexData(view, headerEndPosition);\n\n  if (options.maxDecodingStep < DECODING_STEPS.triangleIndices) {\n    return {header, vertexData};\n  }\n\n  const {triangleIndices, triangleIndicesEndPosition} = decodeTriangleIndices(\n    view,\n    vertexData,\n    vertexDataEndPosition\n  );\n\n  if (options.maxDecodingStep < DECODING_STEPS.edgeIndices) {\n    return {header, vertexData, triangleIndices};\n  }\n\n  const {westIndices, southIndices, eastIndices, northIndices, edgeIndicesEndPosition} =\n    decodeEdgeIndices(view, vertexData, triangleIndicesEndPosition);\n\n  if (options.maxDecodingStep < DECODING_STEPS.extensions) {\n    return {\n      header,\n      vertexData,\n      triangleIndices,\n      westIndices,\n      northIndices,\n      eastIndices,\n      southIndices\n    };\n  }\n\n  const {extensions} = decodeExtensions(view, edgeIndicesEndPosition);\n\n  return {\n    header,\n    vertexData,\n    triangleIndices,\n    westIndices,\n    northIndices,\n    eastIndices,\n    southIndices,\n    extensions\n  };\n}\n"],"file":"decode-quantized-mesh.js"}