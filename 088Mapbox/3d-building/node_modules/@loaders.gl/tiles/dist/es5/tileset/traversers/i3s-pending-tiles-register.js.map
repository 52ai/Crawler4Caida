{"version":3,"sources":["../../../../src/tileset/traversers/i3s-pending-tiles-register.ts"],"names":["I3SPendingTilesRegister","Map","viewportId","frameNumber","viewportMap","frameNumberMap","get","oldCount","set","count"],"mappings":";;;;;;;;;;;;;;;IAIqBA,uB;;;0DACwC,IAAIC,GAAJ,E;;;;;WAO3D,kBAASC,UAAT,EAA6BC,WAA7B,EAAkD;AAChD,UAAMC,WAAW,GAAG,KAAKC,cAAL,CAAoBC,GAApB,CAAwBJ,UAAxB,KAAuC,IAAID,GAAJ,EAA3D;AACA,UAAMM,QAAQ,GAAGH,WAAW,CAACE,GAAZ,CAAgBH,WAAhB,KAAgC,CAAjD;AACAC,MAAAA,WAAW,CAACI,GAAZ,CAAgBL,WAAhB,EAA6BI,QAAQ,GAAG,CAAxC;AACA,WAAKF,cAAL,CAAoBG,GAApB,CAAwBN,UAAxB,EAAoCE,WAApC;AACD;;;WAOD,oBAAWF,UAAX,EAA+BC,WAA/B,EAAoD;AAClD,UAAMC,WAAW,GAAG,KAAKC,cAAL,CAAoBC,GAApB,CAAwBJ,UAAxB,CAApB;;AACA,UAAI,CAACE,WAAL,EAAkB;AAChB;AACD;;AACD,UAAMG,QAAQ,GAAGH,WAAW,CAACE,GAAZ,CAAgBH,WAAhB,KAAgC,CAAjD;AACAC,MAAAA,WAAW,CAACI,GAAZ,CAAgBL,WAAhB,EAA6BI,QAAQ,GAAG,CAAxC;AACD;;;WAQD,gBAAOL,UAAP,EAA2BC,WAA3B,EAAgD;AAAA;;AAC9C,UAAMM,KAAK,GAAG,+BAAKJ,cAAL,CAAoBC,GAApB,CAAwBJ,UAAxB,iFAAqCI,GAArC,CAAyCH,WAAzC,MAAyD,CAAvE;AACA,aAAOM,KAAK,KAAK,CAAjB;AACD","sourcesContent":["/**\n * Counter to register pending tile headers for the particular frameNumber\n * Until all tiles are loaded we won't call `onTraversalEnd` callback\n */\nexport default class I3SPendingTilesRegister {\n  private frameNumberMap: Map<string, Map<number, number>> = new Map();\n\n  /**\n   * Register a new pending tile header for the particular frameNumber\n   * @param viewportId\n   * @param frameNumber\n   */\n  register(viewportId: string, frameNumber: number) {\n    const viewportMap = this.frameNumberMap.get(viewportId) || new Map();\n    const oldCount = viewportMap.get(frameNumber) || 0;\n    viewportMap.set(frameNumber, oldCount + 1);\n    this.frameNumberMap.set(viewportId, viewportMap);\n  }\n\n  /**\n   * Deregister a pending tile header for the particular frameNumber\n   * @param viewportId\n   * @param frameNumber\n   */\n  deregister(viewportId: string, frameNumber: number) {\n    const viewportMap = this.frameNumberMap.get(viewportId);\n    if (!viewportMap) {\n      return;\n    }\n    const oldCount = viewportMap.get(frameNumber) || 1;\n    viewportMap.set(frameNumber, oldCount - 1);\n  }\n\n  /**\n   * Check is there are no pending tile headers registered for the particular frameNumber\n   * @param viewportId\n   * @param frameNumber\n   * @returns\n   */\n  isZero(viewportId: string, frameNumber: number) {\n    const count = this.frameNumberMap.get(viewportId)?.get(frameNumber) || 0;\n    return count === 0;\n  }\n}\n"],"file":"i3s-pending-tiles-register.js"}