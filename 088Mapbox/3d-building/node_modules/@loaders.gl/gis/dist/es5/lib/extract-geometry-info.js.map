{"version":3,"sources":["../../../src/lib/extract-geometry-info.ts"],"names":["extractGeometryInfo","features","pointPositionsCount","pointFeaturesCount","linePositionsCount","linePathsCount","lineFeaturesCount","polygonPositionsCount","polygonObjectsCount","polygonRingsCount","polygonFeaturesCount","coordLengths","Set","feature","geometry","type","add","coordinates","length","point","coord","line","flattened","flat","polygon","Error","coordLength","size","Math","max"],"mappings":"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","sourcesContent":["import {Feature, GeojsonGeometryInfo} from '@loaders.gl/schema';\n\n/**\n *  Initial scan over GeoJSON features\n *  Counts number of coordinates of each geometry type and\n *  keeps track of the max coordinate dimensions\n */\n// eslint-disable-next-line complexity, max-statements\nexport function extractGeometryInfo(features: Feature[]): GeojsonGeometryInfo {\n  // Counts the number of _positions_, so [x, y, z] counts as one\n  let pointPositionsCount = 0;\n  let pointFeaturesCount = 0;\n  let linePositionsCount = 0;\n  let linePathsCount = 0;\n  let lineFeaturesCount = 0;\n  let polygonPositionsCount = 0;\n  let polygonObjectsCount = 0;\n  let polygonRingsCount = 0;\n  let polygonFeaturesCount = 0;\n  const coordLengths = new Set<number>();\n\n  for (const feature of features) {\n    const geometry = feature.geometry;\n    switch (geometry.type) {\n      case 'Point':\n        pointFeaturesCount++;\n        pointPositionsCount++;\n        coordLengths.add(geometry.coordinates.length);\n        break;\n      case 'MultiPoint':\n        pointFeaturesCount++;\n        pointPositionsCount += geometry.coordinates.length;\n        for (const point of geometry.coordinates) {\n          coordLengths.add(point.length);\n        }\n        break;\n      case 'LineString':\n        lineFeaturesCount++;\n        linePositionsCount += geometry.coordinates.length;\n        linePathsCount++;\n\n        for (const coord of geometry.coordinates) {\n          coordLengths.add(coord.length);\n        }\n        break;\n      case 'MultiLineString':\n        lineFeaturesCount++;\n        for (const line of geometry.coordinates) {\n          linePositionsCount += line.length;\n          linePathsCount++;\n\n          // eslint-disable-next-line max-depth\n          for (const coord of line) {\n            coordLengths.add(coord.length);\n          }\n        }\n        break;\n      case 'Polygon':\n        polygonFeaturesCount++;\n        polygonObjectsCount++;\n        polygonRingsCount += geometry.coordinates.length;\n        const flattened = geometry.coordinates.flat();\n        polygonPositionsCount += flattened.length;\n\n        for (const coord of flattened) {\n          coordLengths.add(coord.length);\n        }\n        break;\n      case 'MultiPolygon':\n        polygonFeaturesCount++;\n        for (const polygon of geometry.coordinates) {\n          polygonObjectsCount++;\n          polygonRingsCount += polygon.length;\n          const flattened = polygon.flat();\n          polygonPositionsCount += flattened.length;\n\n          // eslint-disable-next-line max-depth\n          for (const coord of flattened) {\n            coordLengths.add(coord.length);\n          }\n        }\n        break;\n      default:\n        throw new Error(`Unsupported geometry type: ${geometry.type}`);\n    }\n  }\n\n  return {\n    coordLength: coordLengths.size > 0 ? Math.max(...coordLengths) : 2,\n\n    pointPositionsCount,\n    pointFeaturesCount,\n    linePositionsCount,\n    linePathsCount,\n    lineFeaturesCount,\n    polygonPositionsCount,\n    polygonObjectsCount,\n    polygonRingsCount,\n    polygonFeaturesCount\n  };\n}\n"],"file":"extract-geometry-info.js"}