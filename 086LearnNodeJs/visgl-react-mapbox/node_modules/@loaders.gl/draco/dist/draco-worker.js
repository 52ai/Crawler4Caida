(()=>{var wt=Object.create;var C=Object.defineProperty;var It=Object.getOwnPropertyDescriptor;var Mt=Object.getOwnPropertyNames;var Tt=Object.getPrototypeOf,_t=Object.prototype.hasOwnProperty;var St=e=>C(e,"__esModule",{value:!0});var Ot=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var Lt=(e,t,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Mt(t))!_t.call(e,o)&&o!=="default"&&C(e,o,{get:()=>t[o],enumerable:!(r=It(t,o))||r.enumerable});return e},Et=e=>Lt(St(C(e!=null?wt(Tt(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);var st=Ot(()=>{});var U="3.2.9";function rt(e,t){if(!e)throw new Error(t||"loaders.gl assertion failed.")}var g={self:typeof self!="undefined"&&self,window:typeof window!="undefined"&&window,global:typeof global!="undefined"&&global,document:typeof document!="undefined"&&document},he=g.self||g.window||g.global||{},be=g.window||g.self||g.global||{},ot=g.global||g.self||g.window||{},Ae=g.document||{};var B=typeof process!="object"||String(process)!=="[object process]"||process.browser,R=typeof importScripts=="function",De=typeof window!="undefined"&&typeof window.orientation!="undefined",at=typeof process!="undefined"&&process.version&&/v([0-9]*)/.exec(process.version),xe=at&&parseFloat(at[1])||0;function z(e,t=!0,r){let o=r||new Set;if(e){if(nt(e))o.add(e);else if(nt(e.buffer))o.add(e.buffer);else if(!ArrayBuffer.isView(e)){if(t&&typeof e=="object")for(let n in e)z(e[n],t,o)}}return r===void 0?Array.from(o):[]}function nt(e){return e?e instanceof ArrayBuffer||typeof MessagePort!="undefined"&&e instanceof MessagePort||typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap||typeof OffscreenCanvas!="undefined"&&e instanceof OffscreenCanvas:!1}function D(){let parentPort;try{eval("globalThis.parentPort = require('worker_threads').parentPort"),parentPort=globalThis.parentPort}catch{}return parentPort}var V=new Map,p=class{static inWorkerThread(){return typeof self!="undefined"||Boolean(D())}static set onmessage(t){function r(n){let s=D(),{type:i,payload:l}=s?n:n.data;t(i,l)}let o=D();o?(o.on("message",r),o.on("exit",()=>console.debug("Node worker closing"))):globalThis.onmessage=r}static addEventListener(t){let r=V.get(t);r||(r=n=>{if(!Ft(n))return;let s=D(),{type:i,payload:l}=s?n:n.data;t(i,l)}),D()?console.error("not implemented"):globalThis.addEventListener("message",r)}static removeEventListener(t){let r=V.get(t);V.delete(t),D()?console.error("not implemented"):globalThis.removeEventListener("message",r)}static postMessage(t,r){let o={source:"loaders.gl",type:t,payload:r},n=z(r),s=D();s?s.postMessage(o,n):globalThis.postMessage(o,n)}};function Ft(e){let{type:t,data:r}=e;return t==="message"&&r&&typeof r.source=="string"&&r.source.startsWith("loaders.gl")}var w=Et(st());var Pt="latest",Nt=typeof U!="undefined"?U:Pt,$={};async function I(e,t=null,r={}){return t&&(e=it(e,t,r)),$[e]=$[e]||kt(e),await $[e]}function it(e,t,r){if(e.startsWith("http"))return e;let o=r.modules||{};return o[e]?o[e]:B?r.CDN?(rt(r.CDN.startsWith("http")),`${r.CDN}/${t}@${Nt}/dist/libs/${e}`):R?`../src/libs/${e}`:`modules/${t}/src/libs/${e}`:`modules/${t}/dist/libs/${e}`}async function kt(e){if(e.endsWith("wasm"))return await(await fetch(e)).arrayBuffer();if(!B)try{return w&&w.requireFromFile&&await w.requireFromFile(e)}catch{return null}if(R)return importScripts(e);let r=await(await fetch(e)).text();return Bt(r,e)}function Bt(e,t){if(!B)return w.requireFromString&&w.requireFromString(e,t);if(R)return eval.call(ot,e),null;let r=document.createElement("script");r.id=t;try{r.appendChild(document.createTextNode(e))}catch{r.text=e}return document.body.appendChild(r),null}var Rt=0;function q(e){!p.inWorkerThread()||(p.onmessage=async(t,r)=>{switch(t){case"process":try{let{input:o,options:n={},context:s={}}=r,i=await Wt({loader:e,arrayBuffer:o,options:n,context:{...s,parse:vt}});p.postMessage("done",{result:i})}catch(o){let n=o instanceof Error?o.message:"";p.postMessage("error",{error:n})}break;default:}})}function vt(e,t){return new Promise((r,o)=>{let n=Rt++,s=(l,d)=>{if(d.id===n)switch(l){case"done":p.removeEventListener(s),r(d.result);break;case"error":p.removeEventListener(s),o(d.error);break;default:}};p.addEventListener(s);let i={id:n,input:e,options:t};p.postMessage("process",i)})}async function Wt({loader:e,arrayBuffer:t,options:r,context:o}){let n,s;if(e.parseSync||e.parse)n=t,s=e.parseSync||e.parse;else if(e.parseTextSync)n=new TextDecoder().decode(t),s=e.parseTextSync;else throw new Error(`Could not load data with ${e.name} loader`);return r={...r,modules:e&&e.options&&e.options.modules||{},worker:!1},await s(n,{...r},o,e)}var ct="3.2.9";var Ct={draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}},lt={name:"Draco",id:"draco",module:"draco",shapes:["mesh"],version:ct,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:Ct};function G(e){let t=1/0,r=1/0,o=1/0,n=-1/0,s=-1/0,i=-1/0,l=e.POSITION?e.POSITION.value:[],d=l&&l.length;for(let f=0;f<d;f+=3){let y=l[f],A=l[f+1],x=l[f+2];t=y<t?y:t,r=A<r?A:r,o=x<o?x:o,n=y>n?y:n,s=A>s?A:s,i=x>i?x:i}return[[t,r,o],[n,s,i]]}function dt(e,t){if(!e)throw new Error(t||"loader assertion failed.")}var m=class{constructor(t,r){dt(Array.isArray(t)),Ut(t),this.fields=t,this.metadata=r||new Map}compareTo(t){if(this.metadata!==t.metadata||this.fields.length!==t.fields.length)return!1;for(let r=0;r<this.fields.length;++r)if(!this.fields[r].compareTo(t.fields[r]))return!1;return!0}select(...t){let r=Object.create(null);for(let n of t)r[n]=!0;let o=this.fields.filter(n=>r[n.name]);return new m(o,this.metadata)}selectAt(...t){let r=t.map(o=>this.fields[o]).filter(Boolean);return new m(r,this.metadata)}assign(t){let r,o=this.metadata;if(t instanceof m){let i=t;r=i.fields,o=ut(ut(new Map,this.metadata),i.metadata)}else r=t;let n=Object.create(null);for(let i of this.fields)n[i.name]=i;for(let i of r)n[i.name]=i;let s=Object.values(n);return new m(s,o)}};function Ut(e){let t={};for(let r of e)t[r.name]&&console.warn("Schema: duplicated field name",r.name,r),t[r.name]=!0}function ut(e,t){return new Map([...e||new Map,...t||new Map])}var h=class{constructor(t,r,o=!1,n=new Map){this.name=t,this.type=r,this.nullable=o,this.metadata=n}get typeId(){return this.type&&this.type.typeId}clone(){return new h(this.name,this.type,this.nullable,this.metadata)}compareTo(t){return this.name===t.name&&this.type===t.type&&this.nullable===t.nullable&&this.metadata===t.metadata}toString(){return`${this.type}${this.nullable?", nullable":""}${this.metadata?`, metadata: ${this.metadata}`:""}`}};var c;(function(a){a[a.NONE=0]="NONE",a[a.Null=1]="Null",a[a.Int=2]="Int",a[a.Float=3]="Float",a[a.Binary=4]="Binary",a[a.Utf8=5]="Utf8",a[a.Bool=6]="Bool",a[a.Decimal=7]="Decimal",a[a.Date=8]="Date",a[a.Time=9]="Time",a[a.Timestamp=10]="Timestamp",a[a.Interval=11]="Interval",a[a.List=12]="List",a[a.Struct=13]="Struct",a[a.Union=14]="Union",a[a.FixedSizeBinary=15]="FixedSizeBinary",a[a.FixedSizeList=16]="FixedSizeList",a[a.Map=17]="Map",a[a.Dictionary=-1]="Dictionary",a[a.Int8=-2]="Int8",a[a.Int16=-3]="Int16",a[a.Int32=-4]="Int32",a[a.Int64=-5]="Int64",a[a.Uint8=-6]="Uint8",a[a.Uint16=-7]="Uint16",a[a.Uint32=-8]="Uint32",a[a.Uint64=-9]="Uint64",a[a.Float16=-10]="Float16",a[a.Float32=-11]="Float32",a[a.Float64=-12]="Float64",a[a.DateDay=-13]="DateDay",a[a.DateMillisecond=-14]="DateMillisecond",a[a.TimestampSecond=-15]="TimestampSecond",a[a.TimestampMillisecond=-16]="TimestampMillisecond",a[a.TimestampMicrosecond=-17]="TimestampMicrosecond",a[a.TimestampNanosecond=-18]="TimestampNanosecond",a[a.TimeSecond=-19]="TimeSecond",a[a.TimeMillisecond=-20]="TimeMillisecond",a[a.TimeMicrosecond=-21]="TimeMicrosecond",a[a.TimeNanosecond=-22]="TimeNanosecond",a[a.DenseUnion=-23]="DenseUnion",a[a.SparseUnion=-24]="SparseUnion",a[a.IntervalDayTime=-25]="IntervalDayTime",a[a.IntervalYearMonth=-26]="IntervalYearMonth"})(c||(c={}));var u=class{static isNull(t){return t&&t.typeId===c.Null}static isInt(t){return t&&t.typeId===c.Int}static isFloat(t){return t&&t.typeId===c.Float}static isBinary(t){return t&&t.typeId===c.Binary}static isUtf8(t){return t&&t.typeId===c.Utf8}static isBool(t){return t&&t.typeId===c.Bool}static isDecimal(t){return t&&t.typeId===c.Decimal}static isDate(t){return t&&t.typeId===c.Date}static isTime(t){return t&&t.typeId===c.Time}static isTimestamp(t){return t&&t.typeId===c.Timestamp}static isInterval(t){return t&&t.typeId===c.Interval}static isList(t){return t&&t.typeId===c.List}static isStruct(t){return t&&t.typeId===c.Struct}static isUnion(t){return t&&t.typeId===c.Union}static isFixedSizeBinary(t){return t&&t.typeId===c.FixedSizeBinary}static isFixedSizeList(t){return t&&t.typeId===c.FixedSizeList}static isMap(t){return t&&t.typeId===c.Map}static isDictionary(t){return t&&t.typeId===c.Dictionary}get typeId(){return c.NONE}compareTo(t){return this===t}},Q=class extends u{get typeId(){return c.Null}get[Symbol.toStringTag](){return"Null"}toString(){return"Null"}},j=class extends u{get typeId(){return c.Bool}get[Symbol.toStringTag](){return"Bool"}toString(){return"Bool"}},b=class extends u{constructor(t,r){super();this.isSigned=t,this.bitWidth=r}get typeId(){return c.Int}get[Symbol.toStringTag](){return"Int"}toString(){return`${this.isSigned?"I":"Ui"}nt${this.bitWidth}`}},M=class extends b{constructor(){super(!0,8)}},T=class extends b{constructor(){super(!0,16)}},_=class extends b{constructor(){super(!0,32)}};var S=class extends b{constructor(){super(!1,8)}},O=class extends b{constructor(){super(!1,16)}},L=class extends b{constructor(){super(!1,32)}};var pt={HALF:16,SINGLE:32,DOUBLE:64},E=class extends u{constructor(t){super();this.precision=t}get typeId(){return c.Float}get[Symbol.toStringTag](){return"Float"}toString(){return`Float${this.precision}`}};var F=class extends E{constructor(){super(pt.SINGLE)}},P=class extends E{constructor(){super(pt.DOUBLE)}},Y=class extends u{constructor(){super()}get typeId(){return c.Binary}toString(){return"Binary"}get[Symbol.toStringTag](){return"Binary"}},H=class extends u{get typeId(){return c.Utf8}get[Symbol.toStringTag](){return"Utf8"}toString(){return"Utf8"}},zt={DAY:0,MILLISECOND:1},J=class extends u{constructor(t){super();this.unit=t}get typeId(){return c.Date}get[Symbol.toStringTag](){return"Date"}toString(){return`Date${(this.unit+1)*32}<${zt[this.unit]}>`}};var mt={SECOND:1,MILLISECOND:1e3,MICROSECOND:1e6,NANOSECOND:1e9},X=class extends u{constructor(t,r){super();this.unit=t,this.bitWidth=r}get typeId(){return c.Time}toString(){return`Time${this.bitWidth}<${mt[this.unit]}>`}get[Symbol.toStringTag](){return"Time"}};var Z=class extends u{constructor(t,r=null){super();this.unit=t,this.timezone=r}get typeId(){return c.Timestamp}get[Symbol.toStringTag](){return"Timestamp"}toString(){return`Timestamp<${mt[this.unit]}${this.timezone?`, ${this.timezone}`:""}>`}};var Vt={DAY_TIME:0,YEAR_MONTH:1},K=class extends u{constructor(t){super();this.unit=t}get typeId(){return c.Interval}get[Symbol.toStringTag](){return"Interval"}toString(){return`Interval<${Vt[this.unit]}>`}};var N=class extends u{constructor(t,r){super();this.listSize=t,this.children=[r]}get typeId(){return c.FixedSizeList}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get[Symbol.toStringTag](){return"FixedSizeList"}toString(){return`FixedSizeList[${this.listSize}]<${this.valueType}>`}},tt=class extends u{constructor(t){super();this.children=t}get typeId(){return c.Struct}toString(){return`Struct<{${this.children.map(t=>`${t.name}:${t.type}`).join(", ")}}>`}get[Symbol.toStringTag](){return"Struct"}};function ft(e){switch(e.constructor){case Int8Array:return new M;case Uint8Array:return new S;case Int16Array:return new T;case Uint16Array:return new O;case Int32Array:return new _;case Uint32Array:return new L;case Float32Array:return new F;case Float64Array:return new P;default:throw new Error("array type not supported")}}function et(e,t,r){let o=ft(t.value),n=r||yt(t);return new h(e,new N(t.size,new h("value",o)),!1,n)}function yt(e){let t=new Map;return"byteOffset"in e&&t.set("byteOffset",e.byteOffset.toString(10)),"byteStride"in e&&t.set("byteStride",e.byteStride.toString(10)),"normalized"in e&&t.set("normalized",e.normalized.toString()),t}function gt(e,t,r){let o=bt(t.metadata),n=[],s=re(t.attributes);for(let i in e){let l=e[i],d=ht(i,l,s[i]);n.push(d)}if(r){let i=ht("indices",r);n.push(i)}return new m(n,o)}function re(e){let t={};for(let r in e){let o=e[r];t[o.name||"undefined"]=o}return t}function ht(e,t,r){let o=r?bt(r.metadata):void 0;return et(e,t,o)}function bt(e){let t=new Map;for(let r in e)t.set(`${r}.string`,JSON.stringify(e[r]));return t}var At={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},oe={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},ae=4,v=class{constructor(t){this.draco=t,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(t,r={}){let o=new this.draco.DecoderBuffer;o.Init(new Int8Array(t),t.byteLength),this._disableAttributeTransforms(r);let n=this.decoder.GetEncodedGeometryType(o),s=n===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let i;switch(n){case this.draco.TRIANGULAR_MESH:i=this.decoder.DecodeBufferToMesh(o,s);break;case this.draco.POINT_CLOUD:i=this.decoder.DecodeBufferToPointCloud(o,s);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!i.ok()||!s.ptr){let x=`DRACO decompression failed: ${i.error_msg()}`;throw new Error(x)}let l=this._getDracoLoaderData(s,n,r),d=this._getMeshData(s,l,r),f=G(d.attributes),y=gt(d.attributes,l,d.indices);return{loader:"draco",loaderData:l,header:{vertexCount:s.num_points(),boundingBox:f},...d,schema:y}}finally{this.draco.destroy(o),s&&this.draco.destroy(s)}}_getDracoLoaderData(t,r,o){let n=this._getTopLevelMetadata(t),s=this._getDracoAttributes(t,o);return{geometry_type:r,num_attributes:t.num_attributes(),num_points:t.num_points(),num_faces:t instanceof this.draco.Mesh?t.num_faces():0,metadata:n,attributes:s}}_getDracoAttributes(t,r){let o={};for(let n=0;n<t.num_attributes();n++){let s=this.decoder.GetAttribute(t,n),i=this._getAttributeMetadata(t,n);o[s.unique_id()]={unique_id:s.unique_id(),attribute_type:s.attribute_type(),data_type:s.data_type(),num_components:s.num_components(),byte_offset:s.byte_offset(),byte_stride:s.byte_stride(),normalized:s.normalized(),attribute_index:n,metadata:i};let l=this._getQuantizationTransform(s,r);l&&(o[s.unique_id()].quantization_transform=l);let d=this._getOctahedronTransform(s,r);d&&(o[s.unique_id()].octahedron_transform=d)}return o}_getMeshData(t,r,o){let n=this._getMeshAttributes(r,t,o);if(!n.POSITION)throw new Error("DRACO: No position attribute found.");if(t instanceof this.draco.Mesh)switch(o.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:n,indices:{value:this._getTriangleStripIndices(t),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:n,indices:{value:this._getTriangleListIndices(t),size:1}}}return{topology:"point-list",mode:0,attributes:n}}_getMeshAttributes(t,r,o){let n={};for(let s of Object.values(t.attributes)){let i=this._deduceAttributeName(s,o);s.name=i;let{value:l,size:d}=this._getAttributeValues(r,s);n[i]={value:l,size:d,byteOffset:s.byte_offset,byteStride:s.byte_stride,normalized:s.normalized}}return n}_getTriangleListIndices(t){let o=t.num_faces()*3,n=o*ae,s=this.draco._malloc(n);try{return this.decoder.GetTrianglesUInt32Array(t,n,s),new Uint32Array(this.draco.HEAPF32.buffer,s,o).slice()}finally{this.draco._free(s)}}_getTriangleStripIndices(t){let r=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(t,r),ie(r)}finally{this.draco.destroy(r)}}_getAttributeValues(t,r){let o=oe[r.data_type],n=r.num_components,i=t.num_points()*n,l=i*o.BYTES_PER_ELEMENT,d=ne(this.draco,o),f,y=this.draco._malloc(l);try{let A=this.decoder.GetAttribute(t,r.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(t,A,d,l,y),f=new o(this.draco.HEAPF32.buffer,y,i).slice()}finally{this.draco._free(y)}return{value:f,size:n}}_deduceAttributeName(t,r){let o=t.unique_id;for(let[i,l]of Object.entries(r.extraAttributes||{}))if(l===o)return i;let n=t.attribute_type;for(let i in At)if(this.draco[i]===n)return At[i];let s=r.attributeNameEntry||"name";return t.metadata[s]?t.metadata[s].string:`CUSTOM_ATTRIBUTE_${o}`}_getTopLevelMetadata(t){let r=this.decoder.GetMetadata(t);return this._getDracoMetadata(r)}_getAttributeMetadata(t,r){let o=this.decoder.GetAttributeMetadata(t,r);return this._getDracoMetadata(o)}_getDracoMetadata(t){if(!t||!t.ptr)return{};let r={},o=this.metadataQuerier.NumEntries(t);for(let n=0;n<o;n++){let s=this.metadataQuerier.GetEntryName(t,n);r[s]=this._getDracoMetadataField(t,s)}return r}_getDracoMetadataField(t,r){let o=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(t,r,o);let n=se(o);return{int:this.metadataQuerier.GetIntEntry(t,r),string:this.metadataQuerier.GetStringEntry(t,r),double:this.metadataQuerier.GetDoubleEntry(t,r),intArray:n}}finally{this.draco.destroy(o)}}_disableAttributeTransforms(t){let{quantizedAttributes:r=[],octahedronAttributes:o=[]}=t,n=[...r,...o];for(let s of n)this.decoder.SkipAttributeTransform(this.draco[s])}_getQuantizationTransform(t,r){let{quantizedAttributes:o=[]}=r,n=t.attribute_type();if(o.map(i=>this.decoder[i]).includes(n)){let i=new this.draco.AttributeQuantizationTransform;try{if(i.InitFromAttribute(t))return{quantization_bits:i.quantization_bits(),range:i.range(),min_values:new Float32Array([1,2,3]).map(l=>i.min_value(l))}}finally{this.draco.destroy(i)}}return null}_getOctahedronTransform(t,r){let{octahedronAttributes:o=[]}=r,n=t.attribute_type();if(o.map(i=>this.decoder[i]).includes(n)){let i=new this.draco.AttributeQuantizationTransform;try{if(i.InitFromAttribute(t))return{quantization_bits:i.quantization_bits()}}finally{this.draco.destroy(i)}}return null}};function ne(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32;default:return e.DT_INVALID}}function se(e){let t=e.size(),r=new Int32Array(t);for(let o=0;o<t;o++)r[o]=e.GetValue(o);return r}function ie(e){let t=e.size(),r=new Int32Array(t);for(let o=0;o<t;o++)r[o]=e.GetValue(o);return r}var W="1.4.1",ce=`https://www.gstatic.com/draco/versioned/decoders/${W}/draco_decoder.js`,le=`https://www.gstatic.com/draco/versioned/decoders/${W}/draco_wasm_wrapper.js`,de=`https://www.gstatic.com/draco/versioned/decoders/${W}/draco_decoder.wasm`,xr=`https://raw.githubusercontent.com/google/draco/${W}/javascript/draco_encoder.js`,k;async function Dt(e){let t=e.modules||{};return t.draco3d?k=k||t.draco3d.createDecoderModule({}).then(r=>({draco:r})):k=k||ue(e),await k}async function ue(e){let t,r;switch(e.draco&&e.draco.decoderType){case"js":t=await I(ce,"draco",e);break;case"wasm":default:[t,r]=await Promise.all([await I(le,"draco",e),await I(de,"draco",e)])}return t=t||globalThis.DracoDecoderModule,await pe(t,r)}function pe(e,t){let r={};return t&&(r.wasmBinary=t),new Promise(o=>{e({...r,onModuleLoaded:n=>o({draco:n})})})}var xt={...lt,parse:me};async function me(e,t){let{draco:r}=await Dt(t),o=new v(r);try{return o.parseSync(e,t?.draco)}finally{o.destroy()}}q(xt);})();
//# sourceMappingURL=draco-worker.js.map
