"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports._TypecheckDracoLoader = exports.DracoLoader = exports.DracoWorkerLoader = exports.DracoWriterWorker = exports.DracoWriter = void 0;
const draco_loader_1 = require("./draco-loader");
Object.defineProperty(exports, "DracoWorkerLoader", { enumerable: true, get: function () { return draco_loader_1.DracoLoader; } });
const draco_parser_1 = __importDefault(require("./lib/draco-parser"));
const draco_module_loader_1 = require("./lib/draco-module-loader");
const version_1 = require("./lib/utils/version");
const worker_utils_1 = require("@loaders.gl/worker-utils");
var draco_writer_1 = require("./draco-writer");
Object.defineProperty(exports, "DracoWriter", { enumerable: true, get: function () { return draco_writer_1.DracoWriter; } });
/**
 * Browser worker doesn't work because of issue during "draco_encoder.js" loading.
 * Refused to execute script from 'https://raw.githubusercontent.com/google/draco/1.4.1/javascript/draco_encoder.js' because its MIME type ('') is not executable.
 */
exports.DracoWriterWorker = {
    id: worker_utils_1.isBrowser ? 'draco-writer' : 'draco-writer-nodejs',
    name: 'Draco compressed geometry writer',
    module: 'draco',
    version: version_1.VERSION,
    worker: true,
    options: {
        draco: {},
        source: null
    }
};
/**
 * Loader for Draco3D compressed geometries
 */
exports.DracoLoader = {
    ...draco_loader_1.DracoLoader,
    parse
};
async function parse(arrayBuffer, options) {
    const { draco } = await (0, draco_module_loader_1.loadDracoDecoderModule)(options);
    const dracoParser = new draco_parser_1.default(draco);
    try {
        return dracoParser.parseSync(arrayBuffer, options?.draco);
    }
    finally {
        dracoParser.destroy();
    }
}
// TYPE TESTS - TODO find a better way than exporting junk
exports._TypecheckDracoLoader = exports.DracoLoader;
