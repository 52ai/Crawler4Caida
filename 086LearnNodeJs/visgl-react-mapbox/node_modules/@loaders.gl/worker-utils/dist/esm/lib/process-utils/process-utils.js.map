{"version":3,"sources":["../../../../src/lib/process-utils/process-utils.ts"],"names":["ChildProcess","getAvailablePort","defaultPort","Promise","resolve","exec","error","stdout","portsInUse","regex","split","forEach","line","match","push","Number","port","includes"],"mappings":"AAAA,OAAOA,YAAP,MAAyB,eAAzB;AAIA,OAAO,SAASC,gBAAT,CAA0BC,WAAmB,GAAG,IAAhD,EAAuE;AAC5E,SAAO,IAAIC,OAAJ,CAAaC,OAAD,IAAa;AAE9BJ,IAAAA,YAAY,CAACK,IAAb,CAAkB,6BAAlB,EAAiD,CAACC,KAAD,EAAQC,MAAR,KAAmB;AAClE,UAAID,KAAJ,EAAW;AAETF,QAAAA,OAAO,CAACF,WAAD,CAAP;AACA;AACD;;AAED,YAAMM,UAAoB,GAAG,EAA7B;AACA,YAAMC,KAAK,GAAG,mBAAd;AACAF,MAAAA,MAAM,CAACG,KAAP,CAAa,IAAb,EAAmBC,OAAnB,CAA4BC,IAAD,IAAU;AACnC,cAAMC,KAAK,GAAGJ,KAAK,CAACJ,IAAN,CAAWO,IAAX,CAAd;;AACA,YAAIC,KAAJ,EAAW;AACTL,UAAAA,UAAU,CAACM,IAAX,CAAgBC,MAAM,CAACF,KAAK,CAAC,CAAD,CAAN,CAAtB;AACD;AACF,OALD;AAMA,UAAIG,IAAI,GAAGd,WAAX;;AACA,aAAOM,UAAU,CAACS,QAAX,CAAoBD,IAApB,CAAP,EAAkC;AAChCA,QAAAA,IAAI;AACL;;AACDZ,MAAAA,OAAO,CAACY,IAAD,CAAP;AACD,KApBD;AAqBD,GAvBM,CAAP;AAwBD","sourcesContent":["import ChildProcess from 'child_process';\n\n// Get an available port\n// Works on Unix systems\nexport function getAvailablePort(defaultPort: number = 3000): Promise<number> {\n  return new Promise((resolve) => {\n    // Get a list of all ports in use\n    ChildProcess.exec('lsof -i -P -n | grep LISTEN', (error, stdout) => {\n      if (error) {\n        // likely no permission, e.g. CI\n        resolve(defaultPort);\n        return;\n      }\n\n      const portsInUse: number[] = [];\n      const regex = /:(\\d+) \\(LISTEN\\)/;\n      stdout.split('\\n').forEach((line) => {\n        const match = regex.exec(line);\n        if (match) {\n          portsInUse.push(Number(match[1]));\n        }\n      });\n      let port = defaultPort;\n      while (portsInUse.includes(port)) {\n        port++;\n      }\n      resolve(port);\n    });\n  });\n}\n"],"file":"process-utils.js"}