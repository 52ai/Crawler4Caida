{"version":3,"sources":["../../../../../src/lib/extensions/deprecated/KHR_lights_punctual.ts"],"names":["KHR_LIGHTS_PUNCTUAL","name","decode","gltfData","gltfScenegraph","GLTFScenegraph","json","extension","getExtension","lights","removeExtension","nodes","node","nodeExtension","getObjectExtension","light","removeObjectExtension","encode","addExtension","addObjectExtension"],"mappings":";;;;;;;;;;;;;;;AAKA;;AACA;;;;;;;;AAEA,IAAMA,mBAAmB,GAAG,qBAA5B;AAEO,IAAMC,IAAI,GAAGD,mBAAb;;;SAEeE,M;;;;;sEAAf,iBAAsBC,QAAtB;AAAA;;AAAA;AAAA;AAAA;AAAA;AACCC,YAAAA,cADD,GACkB,IAAIC,uBAAJ,CAAmBF,QAAnB,CADlB;AAEEG,YAAAA,IAFF,GAEUF,cAFV,CAEEE,IAFF;AAKCC,YAAAA,SALD,GAKaH,cAAc,CAACI,YAAf,CAA4BR,mBAA5B,CALb;;AAML,gBAAIO,SAAJ,EAAe;AAEbH,cAAAA,cAAc,CAACE,IAAf,CAAoBG,MAApB,GAA6BF,SAAS,CAACE,MAAvC;AACAL,cAAAA,cAAc,CAACM,eAAf,CAA+BV,mBAA/B;AACD;;AAVI,mDAccM,IAAI,CAACK,KAAL,IAAc,EAd5B;;AAAA;AAcL,kEAAqC;AAA1BC,gBAAAA,IAA0B;AAC7BC,gBAAAA,aAD6B,GACbT,cAAc,CAACU,kBAAf,CAAkCF,IAAlC,EAAwCZ,mBAAxC,CADa;;AAEnC,oBAAIa,aAAJ,EAAmB;AAEjBD,kBAAAA,IAAI,CAACG,KAAL,GAAaF,aAAa,CAACE,KAA3B;AACD;;AACDX,gBAAAA,cAAc,CAACY,qBAAf,CAAqCJ,IAArC,EAA2CZ,mBAA3C;AACD;AArBI;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;SAyBeiB,M;;;;;sEAAf,kBAAsBd,QAAtB;AAAA;;AAAA;AAAA;AAAA;AAAA;AACCC,YAAAA,cADD,GACkB,IAAIC,uBAAJ,CAAmBF,QAAnB,CADlB;AAEEG,YAAAA,IAFF,GAEUF,cAFV,CAEEE,IAFF;;AAKL,gBAAIA,IAAI,CAACG,MAAT,EAAiB;AACTF,cAAAA,SADS,GACGH,cAAc,CAACc,YAAf,CAA4BlB,mBAA5B,CADH;AAGf,kCAAO,CAACO,SAAS,CAACE,MAAlB;AAEAF,cAAAA,SAAS,CAACE,MAAV,GAAmBH,IAAI,CAACG,MAAxB;AAEA,qBAAOH,IAAI,CAACG,MAAZ;AACD;;AAKD,gBAAIL,cAAc,CAACE,IAAf,CAAoBG,MAAxB,EAAgC;AAAA,sDAEVL,cAAc,CAACE,IAAf,CAAoBG,MAFV;;AAAA;AAE9B,uEAAgD;AAArCM,kBAAAA,KAAqC;AACxCH,kBAAAA,IADwC,GACjCG,KAAK,CAACH,IAD2B;AAE9CR,kBAAAA,cAAc,CAACe,kBAAf,CAAkCP,IAAlC,EAAwCZ,mBAAxC,EAA6De,KAA7D;AACD;AAL6B;AAAA;AAAA;AAAA;AAAA;;AAO9B,qBAAOX,cAAc,CAACE,IAAf,CAAoBG,MAA3B;AACD;;AA1BI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G","sourcesContent":["// GLTF EXTENSION: KHR_lights_punctual\n// https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_lights_punctual\n\nimport type {GLTF} from '../../types/gltf-types';\n\nimport {assert} from '../../utils/assert';\nimport GLTFScenegraph from '../../api/gltf-scenegraph';\n\nconst KHR_LIGHTS_PUNCTUAL = 'KHR_lights_punctual';\n\nexport const name = KHR_LIGHTS_PUNCTUAL;\n\nexport async function decode(gltfData: {json: GLTF}): Promise<void> {\n  const gltfScenegraph = new GLTFScenegraph(gltfData);\n  const {json} = gltfScenegraph;\n\n  // Move the light array out of the extension and remove the extension\n  const extension = gltfScenegraph.getExtension(KHR_LIGHTS_PUNCTUAL);\n  if (extension) {\n    // @ts-ignore\n    gltfScenegraph.json.lights = extension.lights;\n    gltfScenegraph.removeExtension(KHR_LIGHTS_PUNCTUAL);\n  }\n\n  // Any nodes that have the extension, add lights field pointing to light object\n  // and remove the extension\n  for (const node of json.nodes || []) {\n    const nodeExtension = gltfScenegraph.getObjectExtension(node, KHR_LIGHTS_PUNCTUAL);\n    if (nodeExtension) {\n      // @ts-ignore\n      node.light = nodeExtension.light;\n    }\n    gltfScenegraph.removeObjectExtension(node, KHR_LIGHTS_PUNCTUAL);\n  }\n}\n\n// Move the light ar ray out of the extension and remove the extension\nexport async function encode(gltfData): Promise<void> {\n  const gltfScenegraph = new GLTFScenegraph(gltfData);\n  const {json} = gltfScenegraph;\n\n  // @ts-ignore\n  if (json.lights) {\n    const extension = gltfScenegraph.addExtension(KHR_LIGHTS_PUNCTUAL);\n    // @ts-ignore\n    assert(!extension.lights);\n    // @ts-ignore\n    extension.lights = json.lights;\n    // @ts-ignore\n    delete json.lights;\n  }\n\n  // Any nodes that have lights field pointing to light object\n  // add the extension\n  // @ts-ignore\n  if (gltfScenegraph.json.lights) {\n    // @ts-ignore\n    for (const light of gltfScenegraph.json.lights) {\n      const node = light.node;\n      gltfScenegraph.addObjectExtension(node, KHR_LIGHTS_PUNCTUAL, light);\n    }\n    // @ts-ignore\n    delete gltfScenegraph.json.lights;\n  }\n}\n"],"file":"KHR_lights_punctual.js"}