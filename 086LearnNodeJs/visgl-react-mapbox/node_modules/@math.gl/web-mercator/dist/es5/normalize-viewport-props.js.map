{"version":3,"sources":["../../src/normalize-viewport-props.ts"],"names":["TILE_SIZE","normalizeViewportProps","props","width","height","pitch","longitude","latitude","zoom","bearing","minZoom","halfHeightPixels","Math","pow","minLatitude","maxLatitude"],"mappings":";;;;;;;AAAA;;AACA;;AAGA,IAAMA,SAAS,GAAG,GAAlB;;AAkBe,SAASC,sBAAT,CAAgCC,KAAhC,EAAqE;AAClF,MAAOC,KAAP,GAAmCD,KAAnC,CAAOC,KAAP;AAAA,MAAcC,MAAd,GAAmCF,KAAnC,CAAcE,MAAd;AAAA,qBAAmCF,KAAnC,CAAsBG,KAAtB;AAAA,MAAsBA,KAAtB,6BAA8B,CAA9B;AACA,MAAKC,SAAL,GAA+CJ,KAA/C,CAAKI,SAAL;AAAA,MAAgBC,QAAhB,GAA+CL,KAA/C,CAAgBK,QAAhB;AAAA,MAA0BC,IAA1B,GAA+CN,KAA/C,CAA0BM,IAA1B;AAAA,uBAA+CN,KAA/C,CAAgCO,OAAhC;AAAA,MAAgCA,OAAhC,+BAA0C,CAA1C;;AAGA,MAAIH,SAAS,GAAG,CAAC,GAAb,IAAoBA,SAAS,GAAG,GAApC,EAAyC;AACvCA,IAAAA,SAAS,GAAG,oBAAIA,SAAS,GAAG,GAAhB,EAAqB,GAArB,IAA4B,GAAxC;AACD;;AACD,MAAIG,OAAO,GAAG,CAAC,GAAX,IAAkBA,OAAO,GAAG,GAAhC,EAAqC;AACnCA,IAAAA,OAAO,GAAG,oBAAIA,OAAO,GAAG,GAAd,EAAmB,GAAnB,IAA0B,GAApC;AACD;;AAGD,MAAMC,OAAO,GAAG,qBAAKN,MAAM,GAAGJ,SAAd,CAAhB;;AACA,MAAIQ,IAAI,IAAIE,OAAZ,EAAqB;AACnBF,IAAAA,IAAI,GAAGE,OAAP;AACAH,IAAAA,QAAQ,GAAG,CAAX;AACD,GAHD,MAGO;AAEL,QAAMI,gBAAgB,GAAGP,MAAM,GAAG,CAAT,GAAaQ,IAAI,CAACC,GAAL,CAAS,CAAT,EAAYL,IAAZ,CAAtC;AACA,QAAMM,WAAW,GAAG,qCAAc,CAAC,CAAD,EAAIH,gBAAJ,CAAd,EAAqC,CAArC,CAApB;;AACA,QAAIJ,QAAQ,GAAGO,WAAf,EAA4B;AAC1BP,MAAAA,QAAQ,GAAGO,WAAX;AACD,KAFD,MAEO;AACL,UAAMC,WAAW,GAAG,qCAAc,CAAC,CAAD,EAAIf,SAAS,GAAGW,gBAAhB,CAAd,EAAiD,CAAjD,CAApB;;AACA,UAAIJ,QAAQ,GAAGQ,WAAf,EAA4B;AAC1BR,QAAAA,QAAQ,GAAGQ,WAAX;AACD;AACF;AACF;;AAED,SAAO;AAACZ,IAAAA,KAAK,EAALA,KAAD;AAAQC,IAAAA,MAAM,EAANA,MAAR;AAAgBE,IAAAA,SAAS,EAATA,SAAhB;AAA2BC,IAAAA,QAAQ,EAARA,QAA3B;AAAqCC,IAAAA,IAAI,EAAJA,IAArC;AAA2CH,IAAAA,KAAK,EAALA,KAA3C;AAAkDI,IAAAA,OAAO,EAAPA;AAAlD,GAAP;AACD","sourcesContent":["import {worldToLngLat} from './web-mercator-utils';\nimport {mod, log2} from './math-utils';\n\n// defined by mapbox-gl\nconst TILE_SIZE = 512;\n\n/** Description of viewport */\nexport type ViewportProps = {\n  width: number;\n  height: number;\n  longitude: number;\n  latitude: number;\n  zoom: number;\n  pitch?: number;\n  bearing?: number;\n};\n\n/**\n * Apply mathematical constraints to viewport props\n * @param props\n */\n// eslint-disable-next-line complexity\nexport default function normalizeViewportProps(props: ViewportProps): ViewportProps {\n  const {width, height, pitch = 0} = props;\n  let {longitude, latitude, zoom, bearing = 0} = props;\n\n  // Normalize degrees\n  if (longitude < -180 || longitude > 180) {\n    longitude = mod(longitude + 180, 360) - 180;\n  }\n  if (bearing < -180 || bearing > 180) {\n    bearing = mod(bearing + 180, 360) - 180;\n  }\n\n  // Constrain zoom and shift center at low zoom levels\n  const minZoom = log2(height / TILE_SIZE);\n  if (zoom <= minZoom) {\n    zoom = minZoom;\n    latitude = 0;\n  } else {\n    // Eliminate white space above and below the map\n    const halfHeightPixels = height / 2 / Math.pow(2, zoom);\n    const minLatitude = worldToLngLat([0, halfHeightPixels])[1];\n    if (latitude < minLatitude) {\n      latitude = minLatitude;\n    } else {\n      const maxLatitude = worldToLngLat([0, TILE_SIZE - halfHeightPixels])[1];\n      if (latitude > maxLatitude) {\n        latitude = maxLatitude;\n      }\n    }\n  }\n\n  return {width, height, longitude, latitude, zoom, pitch, bearing};\n}\n"],"file":"normalize-viewport-props.js"}