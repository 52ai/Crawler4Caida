{"version":3,"file":"group-node.js","names":["GroupNode","props","Array","isArray","children","log","assert","every","child","ScenegraphNode","add","push","indexOf","splice","forEach","delete","removeAll","visitor","worldMatrix","Matrix4","modelMatrix","multiplyRight","matrix","traverse"],"sources":["../../../src/scenegraph/group-node.js"],"sourcesContent":["import {Matrix4} from '@math.gl/core';\nimport {log} from '@luma.gl/webgl';\nimport ScenegraphNode from './scenegraph-node';\n\nexport default class GroupNode extends ScenegraphNode {\n  constructor(props = {}) {\n    props = Array.isArray(props) ? {children: props} : props;\n    const {children = []} = props;\n    log.assert(\n      children.every(child => child instanceof ScenegraphNode),\n      'every child must an instance of ScenegraphNode'\n    );\n    super(props);\n    this.children = children;\n  }\n\n  // Unpacks arrays and nested arrays of children\n  add(...children) {\n    for (const child of children) {\n      if (Array.isArray(child)) {\n        this.add(...child);\n      } else {\n        this.children.push(child);\n      }\n    }\n    return this;\n  }\n\n  remove(child) {\n    const children = this.children;\n    const indexOf = children.indexOf(child);\n    if (indexOf > -1) {\n      children.splice(indexOf, 1);\n    }\n    return this;\n  }\n\n  removeAll() {\n    this.children = [];\n    return this;\n  }\n\n  delete() {\n    this.children.forEach(child => child.delete());\n    this.removeAll();\n    super.delete();\n  }\n\n  traverse(visitor, {worldMatrix = new Matrix4()} = {}) {\n    const modelMatrix = new Matrix4(worldMatrix).multiplyRight(this.matrix);\n\n    for (const child of this.children) {\n      if (child instanceof GroupNode) {\n        child.traverse(visitor, {worldMatrix: modelMatrix});\n      } else {\n        visitor(child, {worldMatrix: modelMatrix});\n      }\n    }\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;;AACA;;;;;;;;;;;;IAEqBA,S;;;;;EACnB,qBAAwB;IAAA;;IAAA,IAAZC,KAAY,uEAAJ,EAAI;IAAA;IACtBA,KAAK,GAAGC,KAAK,CAACC,OAAN,CAAcF,KAAd,IAAuB;MAACG,QAAQ,EAAEH;IAAX,CAAvB,GAA2CA,KAAnD;IACA,aAAwBA,KAAxB;IAAA,6BAAOG,QAAP;IAAA,IAAOA,QAAP,gCAAkB,EAAlB;;IACAC,UAAA,CAAIC,MAAJ,CACEF,QAAQ,CAACG,KAAT,CAAe,UAAAC,KAAK;MAAA,OAAIA,KAAK,YAAYC,uBAArB;IAAA,CAApB,CADF,EAEE,gDAFF;;IAIA,0BAAMR,KAAN;IACA,MAAKG,QAAL,GAAgBA,QAAhB;IARsB;EASvB;;;;WAGD,eAAiB;MAAA,kCAAVA,QAAU;QAAVA,QAAU;MAAA;;MACf,6BAAoBA,QAApB,+BAA8B;QAAzB,IAAMI,KAAK,gBAAX;;QACH,IAAIN,KAAK,CAACC,OAAN,CAAcK,KAAd,CAAJ,EAA0B;UACxB,KAAKE,GAAL,8CAAYF,KAAZ;QACD,CAFD,MAEO;UACL,KAAKJ,QAAL,CAAcO,IAAd,CAAmBH,KAAnB;QACD;MACF;;MACD,OAAO,IAAP;IACD;;;WAED,gBAAOA,KAAP,EAAc;MACZ,IAAMJ,QAAQ,GAAG,KAAKA,QAAtB;MACA,IAAMQ,OAAO,GAAGR,QAAQ,CAACQ,OAAT,CAAiBJ,KAAjB,CAAhB;;MACA,IAAII,OAAO,GAAG,CAAC,CAAf,EAAkB;QAChBR,QAAQ,CAACS,MAAT,CAAgBD,OAAhB,EAAyB,CAAzB;MACD;;MACD,OAAO,IAAP;IACD;;;WAED,qBAAY;MACV,KAAKR,QAAL,GAAgB,EAAhB;MACA,OAAO,IAAP;IACD;;;WAED,mBAAS;MACP,KAAKA,QAAL,CAAcU,OAAd,CAAsB,UAAAN,KAAK;QAAA,OAAIA,KAAK,CAACO,MAAN,EAAJ;MAAA,CAA3B;MACA,KAAKC,SAAL;MACA;IACD;;;WAED,kBAASC,OAAT,EAAsD;MAAA,+EAAJ,EAAI;MAAA,4BAAnCC,WAAmC;MAAA,IAAnCA,WAAmC,iCAArB,IAAIC,aAAJ,EAAqB;;MACpD,IAAMC,WAAW,GAAG,IAAID,aAAJ,CAAYD,WAAZ,EAAyBG,aAAzB,CAAuC,KAAKC,MAA5C,CAApB;;MADoD,2CAGhC,KAAKlB,QAH2B;MAAA;;MAAA;QAGpD,oDAAmC;UAAA,IAAxBI,KAAwB;;UACjC,IAAIA,KAAK,YAAYR,SAArB,EAAgC;YAC9BQ,KAAK,CAACe,QAAN,CAAeN,OAAf,EAAwB;cAACC,WAAW,EAAEE;YAAd,CAAxB;UACD,CAFD,MAEO;YACLH,OAAO,CAACT,KAAD,EAAQ;cAACU,WAAW,EAAEE;YAAd,CAAR,CAAP;UACD;QACF;MATmD;QAAA;MAAA;QAAA;MAAA;IAUrD;;;EAtDoCX,uB"}