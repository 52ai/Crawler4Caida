{"version":3,"file":"accessor.js","names":["DEFAULT_ACCESSOR_VALUES","offset","stride","type","size","divisor","normalized","integer","PROP_CHECKS","deprecatedProps","instanced","isInstanced","Accessor","accessors","forEach","accessor","_assign","Object","freeze","JSON","stringify","getBytesPerElement","getBytesPerVertex","props","checkProps","undefined","buffer","index","ArrayType","getTypedArrayFromGLType","BYTES_PER_ELEMENT","assert"],"sources":["../../../src/classes/accessor.js"],"sourcesContent":["import GL from '@luma.gl/constants';\nimport {getTypedArrayFromGLType} from '../webgl-utils/typed-array-utils';\nimport {assert} from '../utils/assert';\nimport {checkProps} from '../utils/check-props';\n\nconst DEFAULT_ACCESSOR_VALUES = {\n  offset: 0,\n  stride: 0,\n  type: GL.FLOAT,\n  size: 1,\n  divisor: 0,\n  normalized: false,\n  integer: false\n};\n\nconst PROP_CHECKS = {\n  deprecatedProps: {\n    instanced: 'divisor',\n    isInstanced: 'divisor'\n  }\n};\n\nexport default class Accessor {\n  static getBytesPerElement(accessor) {\n    // TODO: using `FLOAT` when type is not specified,\n    // ensure this assumption is valid or force API to specify type.\n    const ArrayType = getTypedArrayFromGLType(accessor.type || GL.FLOAT);\n    return ArrayType.BYTES_PER_ELEMENT;\n  }\n\n  static getBytesPerVertex(accessor) {\n    assert(accessor.size);\n    // TODO: using `FLOAT` when type is not specified,\n    // ensure this assumption is valid or force API to specify type.\n    const ArrayType = getTypedArrayFromGLType(accessor.type || GL.FLOAT);\n    return ArrayType.BYTES_PER_ELEMENT * accessor.size;\n  }\n\n  // Combines (merges) a list of accessors. On top of default values\n  // Usually [programAccessor, bufferAccessor, appAccessor]\n  // All props will be set in the returned object.\n  // TODO check for conflicts between values in the supplied accessors\n  static resolve(...accessors) {\n    return new Accessor(...[DEFAULT_ACCESSOR_VALUES, ...accessors]); // Default values\n  }\n\n  constructor(...accessors) {\n    accessors.forEach(accessor => this._assign(accessor)); // Merge in sequence\n    Object.freeze(this);\n  }\n\n  toString() {\n    return JSON.stringify(this);\n  }\n\n  // ACCESSORS\n\n  // TODO - remove>\n  get BYTES_PER_ELEMENT() {\n    return Accessor.getBytesPerElement(this);\n  }\n\n  get BYTES_PER_VERTEX() {\n    return Accessor.getBytesPerVertex(this);\n  }\n\n  // PRIVATE\n\n  // eslint-disable-next-line complexity, max-statements\n  _assign(props = {}) {\n    props = checkProps('Accessor', props, PROP_CHECKS);\n\n    if (props.type !== undefined) {\n      this.type = props.type;\n\n      // Auto-deduce integer type?\n      if (props.type === GL.INT || props.type === GL.UNSIGNED_INT) {\n        this.integer = true;\n      }\n    }\n    if (props.size !== undefined) {\n      this.size = props.size;\n    }\n    if (props.offset !== undefined) {\n      this.offset = props.offset;\n    }\n    if (props.stride !== undefined) {\n      this.stride = props.stride;\n    }\n    if (props.normalized !== undefined) {\n      this.normalized = props.normalized;\n    }\n    if (props.integer !== undefined) {\n      this.integer = props.integer;\n    }\n\n    // INSTANCE DIVISOR\n    if (props.divisor !== undefined) {\n      this.divisor = props.divisor;\n    }\n\n    // Buffer is optional\n    if (props.buffer !== undefined) {\n      this.buffer = props.buffer;\n    }\n\n    // The binding index (for binding e.g. Transform feedbacks and Uniform buffers)\n    // TODO - should this be part of accessor?\n    if (props.index !== undefined) {\n      if (typeof props.index === 'boolean') {\n        this.index = props.index ? 1 : 0;\n      } else {\n        this.index = props.index;\n      }\n    }\n\n    // DEPRECATED\n    if (props.instanced !== undefined) {\n      this.divisor = props.instanced ? 1 : 0;\n    }\n    if (props.isInstanced !== undefined) {\n      this.divisor = props.isInstanced ? 1 : 0;\n    }\n\n    return this;\n  }\n}\n\n// TEST EXPORTS\nexport {DEFAULT_ACCESSOR_VALUES};\n"],"mappings":"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"}