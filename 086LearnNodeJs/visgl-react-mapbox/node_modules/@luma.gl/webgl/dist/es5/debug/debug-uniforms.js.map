{"version":3,"file":"debug-uniforms.js","names":["getDebugTableForUniforms","header","program","uniforms","undefinedOnly","assert","SHADER_MODULE_UNIFORM_REGEXP","PROJECT_MODULE_UNIFORM_REGEXP","uniformLocations","_uniformSetters","table","uniformNames","Object","keys","sort","count","uniformName","match","addUniformToTable","unusedCount","unusedTable","uniform","Type","formatValue","value","isDefined","isUniformDefined","undefined"],"sources":["../../../src/debug/debug-uniforms.js"],"sourcesContent":["import {assert} from '../utils/assert';\nimport {formatValue} from '../utils/format-value';\n\n// Prepares a table suitable for console.table\n/* eslint-disable max-statements, complexity */\nexport function getDebugTableForUniforms({\n  header = 'Uniforms',\n  program,\n  uniforms,\n  undefinedOnly = false\n}) {\n  assert(program);\n\n  const SHADER_MODULE_UNIFORM_REGEXP = '.*_.*';\n  const PROJECT_MODULE_UNIFORM_REGEXP = '.*Matrix'; // TODO - Use explicit list\n\n  const uniformLocations = program._uniformSetters;\n  const table = {}; // {[header]: {}};\n\n  // Add program's provided uniforms (in alphabetical order)\n  const uniformNames = Object.keys(uniformLocations).sort();\n\n  let count = 0;\n\n  // First add non-underscored uniforms (assumed not coming from shader modules)\n  for (const uniformName of uniformNames) {\n    if (\n      !uniformName.match(SHADER_MODULE_UNIFORM_REGEXP) &&\n      !uniformName.match(PROJECT_MODULE_UNIFORM_REGEXP)\n    ) {\n      if (addUniformToTable({table, header, uniforms, uniformName, undefinedOnly})) {\n        count++;\n      }\n    }\n  }\n\n  // add underscored uniforms (assumed from shader modules)\n  for (const uniformName of uniformNames) {\n    if (uniformName.match(PROJECT_MODULE_UNIFORM_REGEXP)) {\n      if (addUniformToTable({table, header, uniforms, uniformName, undefinedOnly})) {\n        count++;\n      }\n    }\n  }\n\n  for (const uniformName of uniformNames) {\n    if (!table[uniformName]) {\n      if (addUniformToTable({table, header, uniforms, uniformName, undefinedOnly})) {\n        count++;\n      }\n    }\n  }\n\n  // Create a table of unused uniforms\n  let unusedCount = 0;\n  const unusedTable = {};\n  if (!undefinedOnly) {\n    for (const uniformName in uniforms) {\n      const uniform = uniforms[uniformName];\n      if (!table[uniformName]) {\n        unusedCount++;\n        unusedTable[uniformName] = {\n          Type: `NOT USED: ${uniform}`,\n          [header]: formatValue(uniform)\n        };\n      }\n    }\n  }\n\n  return {table, count, unusedTable, unusedCount};\n}\n\n// Helper\nfunction addUniformToTable({table, header, uniforms, uniformName, undefinedOnly}) {\n  const value = uniforms[uniformName];\n  const isDefined = isUniformDefined(value);\n  if (!undefinedOnly || !isDefined) {\n    table[uniformName] = {\n      // Add program's unprovided uniforms\n      [header]: isDefined ? formatValue(value) : 'N/A',\n      'Uniform Type': isDefined ? value : 'NOT PROVIDED'\n    };\n    return true;\n  }\n  return false;\n}\n\nfunction isUniformDefined(value) {\n  return value !== undefined && value !== null;\n}\n"],"mappings":"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"}