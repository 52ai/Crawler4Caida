{"version":3,"sources":["../../../src/mapbox/mapbox.js"],"names":["noop","defaultOnError","event","console","error","propTypes","container","PropTypes","object","gl","mapboxApiAccessToken","string","mapboxApiUrl","attributionControl","bool","preserveDrawingBuffer","reuseMaps","transformRequest","func","mapOptions","mapStyle","oneOfType","preventStyleDiffing","visible","asyncRender","onLoad","onError","width","number","height","viewState","longitude","latitude","zoom","bearing","pitch","altitude","defaultProps","document","body","getAccessToken","accessToken","window","location","match","search","process","env","MapboxAccessToken","REACT_APP_MAPBOX_ACCESS_TOKEN","checkPropTypes","props","component","debug","Mapbox","type","target","_map","mapboxgl","Error","initialized","_checkStyleSheet","version","_initialize","_destroy","_update","map","style","_frame","cancel","_render","savedMap","oldContainer","getContainer","newContainer","classList","add","childNodes","length","appendChild","_container","setStyle","diff","isStyleLoaded","_fireLoadEvent","once","_reuse","getContext","HTMLCanvasElement","prototype","center","maxZoom","interactive","trackResize","Map","Object","assign","on","_handleError","off","remove","baseApiUrl","_create","defineProperty","configurable","get","canvas","getCanvas","outline","_updateMapViewport","_updateMapSize","oldProps","newProps","viewportChanged","sizeChanged","_updateMapStyle","redraw","styleChanged","resize","oldViewState","_getViewState","newViewState","jumpTo","_viewStateToMapboxProps","transform","mapboxVersion","testElement","createElement","className","display","isCssLoaded","getComputedStyle","position","link","setAttribute","head"],"mappings":"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","sourcesContent":["// Copyright (c) 2015 Uber Technologies, Inc.\n\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n/* global window, process, HTMLCanvasElement */\nimport * as PropTypes from 'prop-types';\nimport {document} from '../utils/globals';\nimport {normalizeStyle} from '../utils/style-utils';\n\nfunction noop() {}\n\nfunction defaultOnError(event) {\n  if (event) {\n    console.error(event.error); // eslint-disable-line\n  }\n}\n\nconst propTypes = {\n  // Creation parameters\n  container: PropTypes.object /** The container to have the map. */,\n  gl: PropTypes.object /** External WebGLContext to use */,\n\n  mapboxApiAccessToken: PropTypes.string /** Mapbox API access token for Mapbox tiles/styles. */,\n  mapboxApiUrl: PropTypes.string,\n  attributionControl: PropTypes.bool /** Show attribution control or not. */,\n  preserveDrawingBuffer: PropTypes.bool /** Useful when you want to export the canvas as a PNG. */,\n  reuseMaps: PropTypes.bool,\n  transformRequest: PropTypes.func /** The transformRequest callback for the map */,\n  mapOptions: PropTypes.object /** Extra options to pass to Mapbox constructor. See #545. **/,\n  mapStyle: PropTypes.oneOfType([\n    PropTypes.string,\n    PropTypes.object\n  ]) /** The Mapbox style. A string url to a MapboxGL style */,\n  preventStyleDiffing:\n    PropTypes.bool /** There are known issues with style diffing. As stopgap, add option to prevent style diffing. */,\n\n  visible: PropTypes.bool /** Whether the map is visible */,\n  asyncRender: PropTypes.bool /** Whether mapbox should manage its own render cycle */,\n\n  onLoad: PropTypes.func /** The onLoad callback for the map */,\n  onError: PropTypes.func /** The onError callback for the map */,\n\n  // Map view state\n  width: PropTypes.number /** The width of the map. */,\n  height: PropTypes.number /** The height of the map. */,\n\n  viewState: PropTypes.object /** object containing lng/lat/zoom/bearing/pitch */,\n\n  longitude: PropTypes.number /** The longitude of the center of the map. */,\n  latitude: PropTypes.number /** The latitude of the center of the map. */,\n  zoom: PropTypes.number /** The tile zoom level of the map. */,\n  bearing: PropTypes.number /** Specify the bearing of the viewport */,\n  pitch: PropTypes.number /** Specify the pitch of the viewport */,\n  // Note: Non-public API, see https://github.com/mapbox/mapbox-gl-js/issues/1137\n  altitude: PropTypes.number /** Altitude of the viewport camera. Default 1.5 \"screen heights\" */\n};\n\nconst defaultProps = {\n  container: document.body,\n  mapboxApiAccessToken: getAccessToken(),\n  mapboxApiUrl: 'https://api.mapbox.com',\n  preserveDrawingBuffer: false,\n  attributionControl: true,\n  reuseMaps: false,\n  mapOptions: {},\n  mapStyle: 'mapbox://styles/mapbox/light-v8',\n  preventStyleDiffing: false,\n\n  visible: true,\n  asyncRender: false,\n\n  onLoad: noop,\n  onError: defaultOnError,\n\n  width: 0,\n  height: 0,\n  longitude: 0,\n  latitude: 0,\n  zoom: 0,\n  bearing: 0,\n  pitch: 0,\n  altitude: 1.5\n};\n\n// Try to get access token from URL, env, local storage or config\nexport function getAccessToken() {\n  let accessToken = null;\n\n  if (typeof window !== 'undefined' && window.location) {\n    const match = window.location.search.match(/access_token=([^&\\/]*)/);\n    accessToken = match && match[1];\n  }\n\n  if (!accessToken && typeof process !== 'undefined') {\n    // Note: This depends on bundler plugins (e.g. webpack) importing environment correctly\n    accessToken =\n      accessToken || process.env.MapboxAccessToken || process.env.REACT_APP_MAPBOX_ACCESS_TOKEN; // eslint-disable-line\n  }\n\n  // Prevents mapbox from throwing\n  return accessToken || 'no-token';\n}\n\n// Helper function to merge defaultProps and check prop types\nfunction checkPropTypes(props, component = 'component') {\n  // TODO - check for production (unless done by prop types package?)\n  if (props.debug) {\n    PropTypes.checkPropTypes(propTypes, props, 'prop', component);\n  }\n}\n\n// A small wrapper class for mapbox-gl\n// - Provides a prop style interface (that can be trivially used by a React wrapper)\n// - Makes sure mapbox doesn't crash under Node\n// - Handles map reuse (to work around Mapbox resource leak issues)\n// - Provides support for specifying tokens during development\n\nexport default class Mapbox {\n  static initialized = false;\n  static propTypes = propTypes;\n  static defaultProps = defaultProps;\n  static savedMap = null;\n\n  constructor(props) {\n    if (!props.mapboxgl) {\n      throw new Error('Mapbox not available');\n    }\n\n    this.mapboxgl = props.mapboxgl;\n\n    if (!Mapbox.initialized) {\n      Mapbox.initialized = true;\n\n      // Version detection using babel plugin\n      // const VERSION = typeof __VERSION__ !== 'undefined' ? __VERSION__ : 'untranspiled source';\n      // TODO - expose version for debug\n\n      this._checkStyleSheet(this.mapboxgl.version);\n    }\n\n    this._initialize(props);\n  }\n\n  props = defaultProps;\n  width = 0;\n  height = 0;\n\n  finalize() {\n    this._destroy();\n    return this;\n  }\n\n  setProps(props) {\n    this._update(this.props, props);\n    return this;\n  }\n\n  // Force redraw the map now. Typically resize() and jumpTo() is reflected in the next\n  // render cycle, which is managed by Mapbox's animation loop.\n  // This removes the synchronization issue caused by requestAnimationFrame.\n  redraw() {\n    const map = this._map;\n    // map._render will throw error if style does not exist\n    // https://github.com/mapbox/mapbox-gl-js/blob/fb9fc316da14e99ff4368f3e4faa3888fb43c513\n    //   /src/ui/map.js#L1834\n    if (map.style) {\n      // cancel the scheduled update\n      if (map._frame) {\n        map._frame.cancel();\n        map._frame = null;\n      }\n      // the order is important - render() may schedule another update\n      map._render();\n    }\n  }\n\n  // External apps can access map this way\n  getMap() {\n    return this._map;\n  }\n\n  // PRIVATE API\n  _fireLoadEvent = () => {\n    // @ts-ignore\n    this.props.onLoad({\n      type: 'load',\n      target: this._map\n    });\n  };\n\n  _handleError = event => {\n    // @ts-ignore\n    this.props.onError(event);\n  };\n\n  _reuse(props) {\n    this._map = Mapbox.savedMap;\n    // When reusing the saved map, we need to reparent the map(canvas) and other child nodes\n    // intoto the new container from the props.\n    // Step1: reparenting child nodes from old container to new container\n    const oldContainer = this._map.getContainer();\n    const newContainer = props.container;\n    newContainer.classList.add('mapboxgl-map');\n    while (oldContainer.childNodes.length > 0) {\n      newContainer.appendChild(oldContainer.childNodes[0]);\n    }\n    // Step2: replace the internal container with new container from the react component\n    this._map._container = newContainer;\n    Mapbox.savedMap = null;\n\n    // Step3: update style and call onload again\n    if (props.mapStyle) {\n      this._map.setStyle(normalizeStyle(props.mapStyle), {\n        // From the user's perspective, there's no \"diffing\" on initialization\n        // We always rebuild the style from scratch when creating a new Mapbox instance\n        diff: false\n      });\n    }\n\n    // call onload event handler after style fully loaded when style needs update\n    if (this._map.isStyleLoaded()) {\n      this._fireLoadEvent();\n    } else {\n      this._map.once('styledata', this._fireLoadEvent);\n    }\n  }\n\n  _create(props) {\n    // Reuse a saved map, if available\n    if (props.reuseMaps && Mapbox.savedMap) {\n      this._reuse(props);\n    } else {\n      if (props.gl) {\n        const getContext = HTMLCanvasElement.prototype.getContext;\n        // Hijack canvas.getContext to return our own WebGLContext\n        // This will be called inside the mapboxgl.Map constructor\n        HTMLCanvasElement.prototype.getContext = () => {\n          // Unhijack immediately\n          HTMLCanvasElement.prototype.getContext = getContext;\n          return props.gl;\n        };\n      }\n\n      const mapOptions = {\n        container: props.container,\n        center: [0, 0],\n        zoom: 8,\n        pitch: 0,\n        bearing: 0,\n        maxZoom: 24,\n        style: normalizeStyle(props.mapStyle),\n        interactive: false,\n        trackResize: false,\n        attributionControl: props.attributionControl,\n        preserveDrawingBuffer: props.preserveDrawingBuffer\n      };\n      // We don't want to pass a null or no-op transformRequest function.\n      if (props.transformRequest) {\n        mapOptions.transformRequest = props.transformRequest;\n      }\n      this._map = new this.mapboxgl.Map(Object.assign({}, mapOptions, props.mapOptions));\n\n      // Attach optional onLoad function\n      this._map.once('load', this._fireLoadEvent);\n      this._map.on('error', this._handleError);\n    }\n\n    return this;\n  }\n\n  _destroy() {\n    if (!this._map) {\n      return;\n    }\n\n    if (this.props.reuseMaps && !Mapbox.savedMap) {\n      Mapbox.savedMap = this._map;\n\n      // deregister the mapbox event listeners\n      this._map.off('load', this._fireLoadEvent);\n      this._map.off('error', this._handleError);\n      this._map.off('styledata', this._fireLoadEvent);\n    } else {\n      this._map.remove();\n    }\n\n    this._map = null;\n  }\n\n  _initialize(props) {\n    props = Object.assign({}, defaultProps, props);\n    checkPropTypes(props, 'Mapbox');\n\n    // Creation only props\n    this.mapboxgl.accessToken = props.mapboxApiAccessToken || defaultProps.mapboxApiAccessToken;\n    this.mapboxgl.baseApiUrl = props.mapboxApiUrl;\n\n    this._create(props);\n\n    // Hijack dimension properties\n    // This eliminates the timing issue between calling resize() and DOM update\n    /* eslint-disable accessor-pairs */\n    const {container} = props;\n    Object.defineProperty(container, 'offsetWidth', {\n      configurable: true,\n      get: () => this.width\n    });\n    Object.defineProperty(container, 'clientWidth', {\n      configurable: true,\n      get: () => this.width\n    });\n    Object.defineProperty(container, 'offsetHeight', {\n      configurable: true,\n      get: () => this.height\n    });\n    Object.defineProperty(container, 'clientHeight', {\n      configurable: true,\n      get: () => this.height\n    });\n\n    // Disable outline style\n    const canvas = this._map.getCanvas();\n    if (canvas) {\n      canvas.style.outline = 'none';\n    }\n\n    this._updateMapViewport({}, props);\n    this._updateMapSize({}, props);\n\n    this.props = props;\n  }\n\n  _update(oldProps, newProps) {\n    if (!this._map) {\n      return;\n    }\n\n    newProps = Object.assign({}, this.props, newProps);\n    checkPropTypes(newProps, 'Mapbox');\n\n    const viewportChanged = this._updateMapViewport(oldProps, newProps);\n    const sizeChanged = this._updateMapSize(oldProps, newProps);\n    this._updateMapStyle(oldProps, newProps);\n\n    if (!newProps.asyncRender && (viewportChanged || sizeChanged)) {\n      this.redraw();\n    }\n\n    this.props = newProps;\n  }\n\n  _updateMapStyle(oldProps, newProps) {\n    const styleChanged = oldProps.mapStyle !== newProps.mapStyle;\n    if (styleChanged) {\n      this._map.setStyle(normalizeStyle(newProps.mapStyle), {\n        diff: !newProps.preventStyleDiffing\n      });\n    }\n  }\n\n  // Note: needs to be called after render (e.g. in componentDidUpdate)\n  _updateMapSize(oldProps, newProps) {\n    const sizeChanged = oldProps.width !== newProps.width || oldProps.height !== newProps.height;\n    if (sizeChanged) {\n      this.width = newProps.width;\n      this.height = newProps.height;\n      this._map.resize();\n    }\n    return sizeChanged;\n  }\n\n  _updateMapViewport(oldProps, newProps) {\n    const oldViewState = this._getViewState(oldProps);\n    const newViewState = this._getViewState(newProps);\n\n    const viewportChanged =\n      newViewState.latitude !== oldViewState.latitude ||\n      newViewState.longitude !== oldViewState.longitude ||\n      newViewState.zoom !== oldViewState.zoom ||\n      newViewState.pitch !== oldViewState.pitch ||\n      newViewState.bearing !== oldViewState.bearing ||\n      newViewState.altitude !== oldViewState.altitude;\n\n    if (viewportChanged) {\n      this._map.jumpTo(this._viewStateToMapboxProps(newViewState));\n\n      // TODO - jumpTo doesn't handle altitude\n      if (newViewState.altitude !== oldViewState.altitude) {\n        this._map.transform.altitude = newViewState.altitude;\n      }\n    }\n    return viewportChanged;\n  }\n\n  _getViewState(props) {\n    const {longitude, latitude, zoom, pitch = 0, bearing = 0, altitude = 1.5} =\n      props.viewState || props;\n    return {longitude, latitude, zoom, pitch, bearing, altitude};\n  }\n\n  _checkStyleSheet(mapboxVersion = '0.47.0') {\n    if (typeof document === 'undefined') {\n      return;\n    }\n\n    // check mapbox styles\n    try {\n      const testElement = document.createElement('div');\n      testElement.className = 'mapboxgl-map';\n      testElement.style.display = 'none';\n      document.body.appendChild(testElement);\n      const isCssLoaded = window.getComputedStyle(testElement).position !== 'static';\n\n      if (!isCssLoaded) {\n        // attempt to insert mapbox stylesheet\n        const link = document.createElement('link');\n        link.setAttribute('rel', 'stylesheet');\n        link.setAttribute('type', 'text/css');\n        link.setAttribute(\n          'href',\n          `https://api.tiles.mapbox.com/mapbox-gl-js/v${mapboxVersion}/mapbox-gl.css`\n        );\n        document.head.appendChild(link);\n      }\n    } catch (error) {\n      // do nothing\n    }\n  }\n\n  _viewStateToMapboxProps(viewState) {\n    return {\n      center: [viewState.longitude, viewState.latitude],\n      zoom: viewState.zoom,\n      bearing: viewState.bearing,\n      pitch: viewState.pitch\n    };\n  }\n}\n"],"file":"mapbox.js"}