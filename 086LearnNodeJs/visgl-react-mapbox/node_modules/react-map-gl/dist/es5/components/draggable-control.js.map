{"version":3,"sources":["../../../src/components/draggable-control.js"],"names":["draggableControlPropTypes","Object","assign","mapControlPropTypes","draggable","PropTypes","bool","onDrag","func","onDragEnd","onDragStart","offsetLeft","number","offsetTop","draggableControlDefaultProps","mapControlDefaultProps","getDragEventPosition","event","offsetCenter","x","y","getDragEventOffset","container","center","rect","getBoundingClientRect","left","top","getDragLngLat","dragPos","dragOffset","props","context","viewport","unproject","callbacks","state","containerRef","stopPropagation","current","setDragPos","setDragOffset","callbackEvent","lngLat","onDragCancel","registerEvents","thisRef","eventManager","undefined","events","panmove","evt","panend","pancancel","watch","off","useDraggableControl","Boolean"],"mappings":"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","sourcesContent":["// Copyright (c) 2015 Uber Technologies, Inc.\n\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\nimport * as PropTypes from 'prop-types';\nimport {useState, useEffect} from 'react';\nimport useMapControl, {mapControlDefaultProps, mapControlPropTypes} from './use-map-control';\n\nexport const draggableControlPropTypes = Object.assign({}, mapControlPropTypes, {\n  draggable: PropTypes.bool,\n  onDrag: PropTypes.func,\n  onDragEnd: PropTypes.func,\n  onDragStart: PropTypes.func,\n  // Offset from the left\n  offsetLeft: PropTypes.number,\n  // Offset from the top\n  offsetTop: PropTypes.number\n});\n\nexport const draggableControlDefaultProps = Object.assign({}, mapControlDefaultProps, {\n  draggable: false,\n  offsetLeft: 0,\n  offsetTop: 0\n});\n\nfunction getDragEventPosition(event) {\n  const {\n    offsetCenter: {x, y}\n  } = event;\n  return [x, y];\n}\n\n/**\n * Returns offset of top-left of marker from drag start event\n * (used for positioning marker relative to next mouse coordinates)\n */\nfunction getDragEventOffset(event, container) {\n  const {\n    center: {x, y}\n  } = event;\n  if (container) {\n    const rect = container.getBoundingClientRect();\n    return [rect.left - x, rect.top - y];\n  }\n  return null;\n}\n\nfunction getDragLngLat(dragPos, dragOffset, props, context) {\n  const x = dragPos[0] + dragOffset[0] - props.offsetLeft;\n  const y = dragPos[1] + dragOffset[1] - props.offsetTop;\n  // Unproject x/y value while respecting offset coordinates\n  return context.viewport.unproject([x, y]);\n}\n\nfunction onDragStart(event, {props, callbacks, state, context, containerRef}) {\n  const {draggable} = props;\n  if (!draggable) {\n    return;\n  }\n  event.stopPropagation();\n\n  const dragPos = getDragEventPosition(event);\n  const dragOffset = getDragEventOffset(event, containerRef.current);\n  state.setDragPos(dragPos);\n  state.setDragOffset(dragOffset);\n\n  if (callbacks.onDragStart && dragOffset) {\n    const callbackEvent = Object.assign({}, event);\n    callbackEvent.lngLat = getDragLngLat(dragPos, dragOffset, props, context);\n    callbacks.onDragStart(callbackEvent);\n  }\n}\n\nfunction onDrag(event, {props, callbacks, state, context}) {\n  event.stopPropagation();\n\n  const dragPos = getDragEventPosition(event);\n  state.setDragPos(dragPos);\n\n  const {dragOffset} = state;\n  if (callbacks.onDrag && dragOffset) {\n    const callbackEvent = Object.assign({}, event);\n    callbackEvent.lngLat = getDragLngLat(dragPos, dragOffset, props, context);\n    callbacks.onDrag(callbackEvent);\n  }\n}\n\nfunction onDragEnd(event, {props, callbacks, state, context}) {\n  event.stopPropagation();\n\n  const {dragPos, dragOffset} = state;\n  state.setDragPos(null);\n  state.setDragOffset(null);\n\n  if (callbacks.onDragEnd && dragPos && dragOffset) {\n    const callbackEvent = Object.assign({}, event);\n    callbackEvent.lngLat = getDragLngLat(dragPos, dragOffset, props, context);\n    callbacks.onDragEnd(callbackEvent);\n  }\n}\n\nfunction onDragCancel(event, {state}) {\n  event.stopPropagation();\n\n  state.setDragPos(null);\n  state.setDragOffset(null);\n}\n\nfunction registerEvents(thisRef) {\n  const {eventManager} = thisRef.context;\n  if (!eventManager || !thisRef.state.dragPos) {\n    return undefined;\n  }\n\n  // panstart is already attached by parent class BaseControl,\n  // here we just add listeners for subsequent drag events\n  const events = {\n    panmove: evt => onDrag(evt, thisRef),\n    panend: evt => onDragEnd(evt, thisRef),\n    pancancel: evt => onDragCancel(evt, thisRef)\n  };\n  eventManager.watch(events);\n\n  // Clean up\n  return () => {\n    eventManager.off(events);\n  };\n}\n\nexport default function useDraggableControl(props) {\n  const [dragPos, setDragPos] = useState(null);\n  const [dragOffset, setDragOffset] = useState(null);\n\n  const thisRef = useMapControl({\n    ...props,\n    onDragStart\n  });\n\n  thisRef.callbacks = props;\n  thisRef.state.dragPos = dragPos;\n  thisRef.state.setDragPos = setDragPos;\n  thisRef.state.dragOffset = dragOffset;\n  thisRef.state.setDragOffset = setDragOffset;\n\n  useEffect(() => registerEvents(thisRef), [thisRef.context.eventManager, Boolean(dragPos)]);\n\n  return thisRef;\n}\n"],"file":"draggable-control.js"}